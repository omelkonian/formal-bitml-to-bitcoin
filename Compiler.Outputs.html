<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Compiler.Outputs</title><link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css'/><style>.github-fork-ribbon:before { background-color: #333; }</style><link rel="stylesheet" href="css/Agda.css"></head><body><a class='github-fork-ribbon'href='https://github.com/omelkonian/formal-bitml-to-bitcoin/tree/master/Compiler/Outputs.agda'data-ribbon='Source code on Github' title='Source code on Github'>Source code on Github</a><pre class="Agda"><a id="1" class="Keyword">open</a> <a id="6" class="Keyword">import</a> <a id="13" href="Prelude.Init.html" class="Module">Prelude.Init</a><a id="25" class="Symbol">;</a> <a id="27" class="Keyword">open</a> <a id="32" href="Prelude.Init.html#504" class="Module">SetAsType</a>

<a id="43" class="Keyword">open</a> <a id="48" class="Keyword">import</a> <a id="55" href="Bitcoin.html" class="Module">Bitcoin</a> <a id="63" class="Keyword">using</a> <a id="69" class="Symbol">(</a><a id="70" href="Bitcoin.Tx.Base.html#973" class="Record">Tx</a><a id="72" class="Symbol">)</a>

<a id="75" class="Keyword">open</a> <a id="80" class="Keyword">import</a> <a id="87" href="BitML.BasicTypes.html" class="Module">BitML.BasicTypes</a> <a id="104" class="Keyword">using</a> <a id="110" class="Symbol">(</a><a id="111" href="BitML.BasicTypes.html#631" class="Record">⋯</a><a id="112" class="Symbol">)</a>

<a id="115" class="Keyword">module</a> <a id="122" href="Compiler.Outputs.html" class="Module">Compiler.Outputs</a> <a id="139" class="Symbol">(</a><a id="140" href="Compiler.Outputs.html#140" class="Bound">⋯</a> <a id="142" class="Symbol">:</a> <a id="144" href="BitML.BasicTypes.html#631" class="Record">⋯</a><a id="145" class="Symbol">)</a> <a id="147" class="Keyword">where</a>

<a id="154" class="Keyword">open</a> <a id="159" class="Keyword">import</a> <a id="166" href="BitML.html" class="Module">BitML</a> <a id="172" href="Compiler.Outputs.html#140" class="Bound">⋯</a>

<a id="175" class="Comment">-- type of initial transaction</a>
<a id="InitTx"></a><a id="206" href="Compiler.Outputs.html#206" class="Function">InitTx</a> <a id="213" class="Symbol">:</a> <a id="215" href="BitML.Contracts.Types.html#1748" class="Datatype">Precondition</a> <a id="228" class="Symbol">→</a> <a id="230" href="Agda.Primitive.html#320" class="Primitive">Type</a>
<a id="235" href="Compiler.Outputs.html#206" class="Function">InitTx</a> <a id="242" href="Compiler.Outputs.html#242" class="Bound">g</a> <a id="244" class="Symbol">=</a> <a id="246" href="Bitcoin.Tx.Base.html#973" class="Record">Tx</a> <a id="249" class="Symbol">(</a><a id="250" href="Data.List.Base.html#4873" class="Function">length</a> <a id="257" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="259" href="BitML.Contracts.Collections.html#9014" class="Function">persistentIds</a> <a id="273" href="Compiler.Outputs.html#242" class="Bound">g</a><a id="274" class="Symbol">)</a> <a id="276" class="Number">1</a>

<a id="279" class="Comment">-- type of subterm transactions</a>
<a id="Inᵈ"></a><a id="311" href="Compiler.Outputs.html#311" class="Function">Inᵈ</a> <a id="Outᵈ"></a><a id="315" href="Compiler.Outputs.html#315" class="Function">Outᵈ</a> <a id="320" class="Symbol">:</a> <a id="322" href="BitML.Contracts.Types.html#488" class="Datatype">Branch</a> <a id="329" class="Symbol">→</a> <a id="331" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a>
<a id="333" href="Compiler.Outputs.html#311" class="Function">Inᵈ</a> <a id="337" class="Symbol">=</a> <a id="339" href="BitML.Contracts.Collections.html#13244" class="Function">removeTopDecorations</a> <a id="360" href="Prelude.Init.html#13946" class="Function Operator">&gt;≡&gt;</a> <a id="364" class="Symbol">λ</a> <a id="366" class="Keyword">where</a>
  <a id="374" class="Symbol">(</a><a id="375" href="BitML.Contracts.Types.html#693" class="InductiveConstructor Operator">put</a> <a id="379" href="Compiler.Outputs.html#379" class="Bound">xs</a> <a id="382" href="BitML.Contracts.Types.html#693" class="InductiveConstructor Operator">&amp;reveal</a> <a id="390" class="Symbol">_</a> <a id="392" href="BitML.Contracts.Types.html#693" class="InductiveConstructor Operator">if</a> <a id="395" class="Symbol">_</a> <a id="397" href="BitML.Contracts.Types.html#693" class="InductiveConstructor Operator">⇒</a> <a id="399" class="Symbol">_)</a> <a id="402" class="Symbol">→</a> <a id="404" href="Agda.Builtin.Nat.html#217" class="InductiveConstructor">suc</a> <a id="408" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="410" href="Data.List.Base.html#4873" class="Function">length</a> <a id="417" href="Compiler.Outputs.html#379" class="Bound">xs</a>
  <a id="422" class="CatchallClause Symbol">_</a> <a id="424" class="Symbol">→</a> <a id="426" class="Number">1</a>
<a id="428" href="Compiler.Outputs.html#315" class="Function">Outᵈ</a> <a id="433" class="Symbol">=</a> <a id="435" href="BitML.Contracts.Collections.html#13244" class="Function">removeTopDecorations</a> <a id="456" href="Prelude.Init.html#13946" class="Function Operator">&gt;≡&gt;</a> <a id="460" class="Symbol">λ</a> <a id="462" class="Keyword">where</a>
  <a id="470" class="Symbol">(</a><a id="471" href="BitML.Contracts.Types.html#941" class="InductiveConstructor">split</a> <a id="477" href="Compiler.Outputs.html#477" class="Bound">vcs</a><a id="480" class="Symbol">)</a> <a id="482" class="Symbol">→</a> <a id="484" href="Data.List.Base.html#4873" class="Function">length</a> <a id="491" href="Compiler.Outputs.html#477" class="Bound">vcs</a>
  <a id="497" class="CatchallClause Symbol">_</a> <a id="499" class="Symbol">→</a> <a id="501" class="Number">1</a>

<a id="BranchTx"></a><a id="504" href="Compiler.Outputs.html#504" class="Function">BranchTx</a> <a id="513" class="Symbol">:</a> <a id="515" href="BitML.Contracts.Types.html#488" class="Datatype">Branch</a> <a id="522" class="Symbol">→</a> <a id="524" href="Agda.Primitive.html#320" class="Primitive">Type</a>
<a id="529" href="Compiler.Outputs.html#504" class="Function">BranchTx</a> <a id="538" href="Compiler.Outputs.html#538" class="Bound">d</a> <a id="540" class="Symbol">=</a> <a id="542" href="Bitcoin.Tx.Base.html#973" class="Record">Tx</a> <a id="545" class="Symbol">(</a><a id="546" href="Compiler.Outputs.html#311" class="Function">Inᵈ</a> <a id="550" href="Compiler.Outputs.html#538" class="Bound">d</a><a id="551" class="Symbol">)</a> <a id="553" class="Symbol">(</a><a id="554" href="Compiler.Outputs.html#315" class="Function">Outᵈ</a> <a id="559" href="Compiler.Outputs.html#538" class="Bound">d</a><a id="560" class="Symbol">)</a>
<a id="562" class="Comment">--   with _ ← decorations∘remove≡[] {d}</a>
<a id="602" class="Comment">--   with removeTopDecorations d</a>
<a id="635" class="Comment">-- ... | put xs &amp;reveal _ if _ ⇒ c = Tx (suc $ length xs) 1</a>
<a id="695" class="Comment">-- ... | split vcs                 = Tx 1                 (length vcs)</a>
<a id="766" class="Comment">-- ... | withdraw _                = Tx 1                 1</a>
</pre></body></html>