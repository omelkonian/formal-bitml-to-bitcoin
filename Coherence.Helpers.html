<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Coherence.Helpers</title><link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css'/><style>.github-fork-ribbon:before { background-color: #333; }</style><link rel="stylesheet" href="css/Agda.css"></head><body><a class='github-fork-ribbon'href='https://github.com/omelkonian/formal-bitml-to-bitcoin/tree/master/Coherence/Helpers.agda'data-ribbon='Source code on Github' title='Source code on Github'>Source code on Github</a><pre class="Agda"><a id="1" class="Keyword">open</a> <a id="6" class="Keyword">import</a> <a id="13" href="Prelude.Init.html" class="Module">Prelude.Init</a><a id="25" class="Symbol">;</a> <a id="27" class="Keyword">open</a> <a id="32" href="Prelude.Init.html#504" class="Module">SetAsType</a>
<a id="42" class="Keyword">open</a> <a id="47" href="Prelude.Init.html#7254" class="Module">L.Mem</a>
<a id="53" class="Keyword">open</a> <a id="58" href="Prelude.Init.html#6429" class="Module">L.All</a> <a id="64" class="Keyword">using</a> <a id="70" class="Symbol">(</a><a id="71" href="Data.List.Relation.Unary.All.Properties.html#3427" class="Function">¬Any⇒All¬</a><a id="80" class="Symbol">)</a>
<a id="82" class="Keyword">open</a> <a id="87" href="Prelude.Init.html#6563" class="Module">L.Any</a> <a id="93" class="Keyword">using</a> <a id="99" class="Symbol">(</a><a id="100" href="Data.List.Relation.Unary.Any.Properties.html#4337" class="Function">lookup-index</a><a id="112" class="Symbol">)</a>
<a id="114" class="Keyword">open</a> <a id="119" class="Keyword">import</a> <a id="126" href="Prelude.Lists.Mappings.html" class="Module">Prelude.Lists.Mappings</a>
<a id="149" class="Keyword">open</a> <a id="154" class="Keyword">import</a> <a id="161" href="Prelude.Lists.Indexed.html" class="Module">Prelude.Lists.Indexed</a>
<a id="183" class="Keyword">open</a> <a id="188" class="Keyword">import</a> <a id="195" href="Prelude.Lists.Dec.html" class="Module">Prelude.Lists.Dec</a>
<a id="213" class="Keyword">open</a> <a id="218" class="Keyword">import</a> <a id="225" href="Prelude.Ord.html" class="Module">Prelude.Ord</a>
<a id="237" class="Keyword">open</a> <a id="242" class="Keyword">import</a> <a id="249" href="Prelude.InferenceRules.html" class="Module">Prelude.InferenceRules</a>
<a id="272" class="Keyword">open</a> <a id="277" class="Keyword">import</a> <a id="284" href="Prelude.Membership.html" class="Module">Prelude.Membership</a> <a id="303" class="Keyword">using</a> <a id="309" class="Symbol">(</a><a id="310" href="Prelude.Membership.html#455" class="Field Operator">_∈?_</a><a id="314" class="Symbol">;</a> <a id="316" href="Prelude.Membership.html#613" class="Function Operator">_∉?_</a><a id="320" class="Symbol">)</a>
<a id="322" class="Keyword">open</a> <a id="327" class="Keyword">import</a> <a id="334" href="Prelude.Decidable.html" class="Module">Prelude.Decidable</a>
<a id="352" class="Keyword">open</a> <a id="357" class="Keyword">import</a> <a id="364" href="Prelude.DecEq.html" class="Module">Prelude.DecEq</a>
<a id="378" class="Keyword">open</a> <a id="383" class="Keyword">import</a> <a id="390" href="Prelude.Nary.html" class="Module">Prelude.Nary</a>

<a id="404" class="Keyword">open</a> <a id="409" class="Keyword">import</a> <a id="416" href="SecureCompilation.ModuleParameters.html" class="Module">SecureCompilation.ModuleParameters</a> <a id="451" class="Keyword">using</a> <a id="457" class="Symbol">(</a><a id="458" href="SecureCompilation.ModuleParameters.html#209" class="Record">⋯</a><a id="459" class="Symbol">)</a>
<a id="461" class="Keyword">module</a> <a id="468" href="Coherence.Helpers.html" class="Module">Coherence.Helpers</a> <a id="486" class="Symbol">(</a><a id="487" href="Coherence.Helpers.html#487" class="Bound">⋯</a> <a id="489" class="Symbol">:</a> <a id="491" href="SecureCompilation.ModuleParameters.html#209" class="Record">⋯</a><a id="492" class="Symbol">)</a> <a id="494" class="Symbol">(</a><a id="495" class="Keyword">let</a> <a id="499" class="Keyword">open</a> <a id="504" href="SecureCompilation.ModuleParameters.html#209" class="Module">⋯</a> <a id="506" href="Coherence.Helpers.html#487" class="Bound">⋯</a><a id="507" class="Symbol">)</a> <a id="509" class="Keyword">where</a>
<a id="515" class="Keyword">open</a> <a id="520" class="Keyword">import</a> <a id="527" href="SymbolicModel.html" class="Module">SymbolicModel</a> <a id="541" href="SecureCompilation.ModuleParameters.html#282" class="Field">⋯′</a>
  <a id="546" class="Keyword">hiding</a> <a id="553" class="Symbol">(</a><a id="554" href="BitML.Contracts.Types.html#1222" class="Generalizable">d</a><a id="555" class="Symbol">)</a>
<a id="557" class="Keyword">open</a> <a id="562" class="Keyword">import</a> <a id="569" href="ComputationalModel.html" class="Module">ComputationalModel</a> <a id="588" href="SecureCompilation.ModuleParameters.html#282" class="Field">⋯′</a> <a id="591" href="SecureCompilation.ModuleParameters.html#450" class="Field">finPart</a> <a id="599" href="SecureCompilation.ModuleParameters.html#487" class="Field">keypairs</a>
  <a id="610" class="Keyword">hiding</a> <a id="617" class="Symbol">(</a><a id="618" href="ComputationalModel.Run.html#1378" class="Generalizable">R</a><a id="619" class="Symbol">;</a> <a id="621" href="Bitcoin.BasicTypes.html#429" class="Generalizable">t</a><a id="622" class="Symbol">)</a>
<a id="624" class="Keyword">open</a> <a id="629" class="Keyword">import</a> <a id="636" href="Compiler.html" class="Module">Compiler</a> <a id="645" href="SecureCompilation.ModuleParameters.html#282" class="Field">⋯′</a> <a id="648" href="SecureCompilation.ModuleParameters.html#357" class="Field">η</a>

<a id="651" class="Comment">-- Checking past oracle interactions.</a>
<a id="CheckInteractions"></a><a id="689" href="Coherence.Helpers.html#689" class="Function">CheckInteractions</a> <a id="707" class="Symbol">:</a> <a id="709" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="714" href="ComputationalModel.Run.html#5155" class="Function">OracleInteraction</a> <a id="732" class="Symbol">→</a> <a id="734" href="Prelude.Init.html#13767" class="Function">Pred₀</a> <a id="740" class="Symbol">(</a><a id="741" href="BitML.BasicTypes.html#303" class="Function">Secret</a> <a id="748" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="750" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="756" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a> <a id="758" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="760" href="Bitcoin.BasicTypes.html#351" class="Function">HashId</a><a id="766" class="Symbol">)</a>
<a id="768" href="Coherence.Helpers.html#689" class="Function">CheckInteractions</a> <a id="786" href="Coherence.Helpers.html#786" class="Bound">os</a> <a id="789" class="Symbol">=</a> <a id="791" class="Symbol">λ</a> <a id="793" class="Keyword">where</a>
  <a id="801" class="Symbol">(_</a> <a id="804" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="806" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="811" href="Coherence.Helpers.html#811" class="Bound">Nᵢ</a> <a id="814" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="816" href="Coherence.Helpers.html#816" class="Bound">hᵢ</a><a id="818" class="Symbol">)</a> <a id="820" class="Symbol">→</a>
    <a id="826" href="Data.Product.html#1378" class="Function">∃</a> <a id="828" class="Symbol">λ</a> <a id="830" href="Coherence.Helpers.html#830" class="Bound">B</a> <a id="832" class="Symbol">→</a> <a id="834" href="Data.Product.html#1378" class="Function">∃</a> <a id="836" class="Symbol">λ</a> <a id="838" href="Coherence.Helpers.html#838" class="Bound">mᵢ</a> <a id="841" class="Symbol">→</a> <a id="843" class="Symbol">((</a><a id="845" href="Coherence.Helpers.html#830" class="Bound">B</a> <a id="847" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="849" href="Coherence.Helpers.html#838" class="Bound">mᵢ</a> <a id="852" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="854" href="Coherence.Helpers.html#816" class="Bound">hᵢ</a><a id="856" class="Symbol">)</a> <a id="858" href="Data.List.Membership.Setoid.html#896" class="Function Operator">∈</a> <a id="860" href="Coherence.Helpers.html#786" class="Bound">os</a><a id="862" class="Symbol">)</a> <a id="864" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="866" class="Symbol">(</a><a id="867" href="ComputationalModel.Serialization.html#245" class="Function Operator">∣</a> <a id="869" href="Coherence.Helpers.html#838" class="Bound">mᵢ</a> <a id="872" href="ComputationalModel.Serialization.html#245" class="Function Operator">∣ᵐ</a> <a id="875" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="877" href="SecureCompilation.ModuleParameters.html#357" class="Field">η</a> <a id="879" href="Agda.Builtin.Nat.html#319" class="Primitive Operator">+</a> <a id="881" href="Coherence.Helpers.html#811" class="Bound">Nᵢ</a><a id="883" class="Symbol">)</a>
  <a id="887" class="Symbol">(_</a> <a id="890" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="892" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="900" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="902" href="Coherence.Helpers.html#902" class="Bound">hᵢ</a><a id="904" class="Symbol">)</a> <a id="906" class="Symbol">→</a>
    <a id="912" href="Coherence.Helpers.html#902" class="Bound">hᵢ</a> <a id="915" href="Data.List.Membership.Setoid.html#945" class="Function Operator">∉</a> <a id="917" href="Data.List.Base.html#1553" class="Function">map</a> <a id="921" href="Prelude.Nary.html#3005" class="Function">select₃</a> <a id="929" class="Symbol">(</a><a id="930" href="Data.List.Base.html#8101" class="Function">filter</a> <a id="937" class="Symbol">((</a><a id="939" href="SecureCompilation.ModuleParameters.html#357" class="Field">η</a> <a id="941" href="Prelude.Ord.Dec.html#430" class="Function Operator">≤?_</a><a id="944" class="Symbol">)</a> <a id="946" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="948" href="ComputationalModel.Serialization.html#245" class="Function Operator">∣_∣ᵐ</a> <a id="953" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="955" href="Prelude.Nary.html#2292" class="Function">select₂</a><a id="962" class="Symbol">)</a> <a id="964" href="Coherence.Helpers.html#786" class="Bound">os</a><a id="966" class="Symbol">)</a>

<a id="CheckOracleInteractions"></a><a id="969" href="Coherence.Helpers.html#969" class="Function">CheckOracleInteractions</a> <a id="993" class="Symbol">:</a> <a id="995" href="ComputationalModel.Run.html#4253" class="Datatype">CRun</a> <a id="1000" class="Symbol">→</a> <a id="1002" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="1007" class="Symbol">(</a><a id="1008" href="BitML.BasicTypes.html#303" class="Function">Secret</a> <a id="1015" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="1017" href="Agda.Builtin.Maybe.html#118" class="Datatype">Maybe</a> <a id="1023" href="Agda.Builtin.Nat.html#186" class="Datatype">ℕ</a> <a id="1025" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="1027" href="Bitcoin.BasicTypes.html#351" class="Function">HashId</a><a id="1033" class="Symbol">)</a> <a id="1035" class="Symbol">→</a> <a id="1037" href="Agda.Primitive.html#320" class="Primitive">Set</a>
<a id="1041" href="Coherence.Helpers.html#969" class="Function">CheckOracleInteractions</a> <a id="1065" href="Coherence.Helpers.html#1065" class="Bound">Rᶜ</a> <a id="1068" class="Symbol">=</a> <a id="1070" href="Data.List.Relation.Unary.All.html#1453" class="Datatype">All</a> <a id="1074" class="Symbol">(</a><a id="1075" href="Coherence.Helpers.html#689" class="Function">CheckInteractions</a> <a id="1093" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="1095" href="ComputationalModel.Run.html#5971" class="Function">oracleInteractionsᶜ</a> <a id="1115" href="Coherence.Helpers.html#1065" class="Bound">Rᶜ</a><a id="1117" class="Symbol">)</a>

<a id="1120" class="Keyword">instance</a>
  <a id="Dec-CheckOracle"></a><a id="1131" href="Coherence.Helpers.html#1131" class="Function">Dec-CheckOracle</a> <a id="1147" class="Symbol">:</a> <a id="1149" class="Symbol">∀</a> <a id="1151" class="Symbol">{</a><a id="1152" href="Coherence.Helpers.html#1152" class="Bound">os</a><a id="1154" class="Symbol">}</a> <a id="1156" class="Symbol">→</a> <a id="1158" href="Coherence.Helpers.html#689" class="Function">CheckInteractions</a> <a id="1176" href="Coherence.Helpers.html#1152" class="Bound">os</a> <a id="1179" href="Prelude.Decidable.Core.html#527" class="Function Operator">⁇¹</a>
  <a id="1184" href="Coherence.Helpers.html#1131" class="Function">Dec-CheckOracle</a> <a id="1200" class="Symbol">{</a><a id="1201" href="Coherence.Helpers.html#1201" class="Bound">os</a><a id="1203" class="Symbol">}</a> <a id="1205" class="Symbol">{</a><a id="1206" href="Coherence.Helpers.html#1206" class="Bound">x</a><a id="1207" class="Symbol">}</a> <a id="1209" class="Symbol">.</a><a id="1210" href="Prelude.Decidable.Core.html#166" class="Field">dec</a>
    <a id="1218" class="Keyword">with</a> <a id="1223" href="Coherence.Helpers.html#1206" class="Bound">x</a>
  <a id="1227" class="Symbol">...</a> <a id="1231" class="Symbol">|</a> <a id="1233" class="Symbol">_</a> <a id="1235" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1237" href="Agda.Builtin.Maybe.html#177" class="InductiveConstructor">nothing</a> <a id="1245" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1247" href="Coherence.Helpers.html#1247" class="Bound">hᵢ</a> <a id="1250" class="Symbol">=</a> <a id="1252" href="Coherence.Helpers.html#1247" class="Bound">hᵢ</a> <a id="1255" href="Prelude.Membership.html#613" class="Function Operator">∉?</a> <a id="1258" href="Data.List.Base.html#1553" class="Function">map</a> <a id="1262" href="Prelude.Nary.html#3005" class="Function">select₃</a> <a id="1270" class="Symbol">(</a><a id="1271" href="Data.List.Base.html#8101" class="Function">filter</a> <a id="1278" class="Symbol">((</a><a id="1280" href="SecureCompilation.ModuleParameters.html#357" class="Field">η</a> <a id="1282" href="Prelude.Ord.Dec.html#430" class="Function Operator">≤?_</a><a id="1285" class="Symbol">)</a> <a id="1287" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1289" href="ComputationalModel.Serialization.html#245" class="Function Operator">∣_∣ᵐ</a> <a id="1294" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1296" href="Prelude.Nary.html#2292" class="Function">select₂</a><a id="1303" class="Symbol">)</a> <a id="1305" class="Bound">os</a><a id="1307" class="Symbol">)</a>
  <a id="1311" class="Symbol">...</a> <a id="1315" class="Symbol">|</a> <a id="1317" class="Symbol">_</a> <a id="1319" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1321" href="Agda.Builtin.Maybe.html#156" class="InductiveConstructor">just</a> <a id="1326" href="Coherence.Helpers.html#1326" class="Bound">Nᵢ</a> <a id="1329" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1331" href="Coherence.Helpers.html#1331" class="Bound">hᵢ</a>
    <a id="1338" class="Keyword">with</a> <a id="1343" href="Prelude.Decidable.Core.html#475" class="Function Operator">¿</a> <a id="1345" href="Data.List.Relation.Unary.Any.html#1165" class="Datatype">Any</a> <a id="1349" class="Symbol">(λ</a> <a id="1352" class="Symbol">(_</a> <a id="1355" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1357" href="Coherence.Helpers.html#1357" class="Bound">m</a> <a id="1359" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1361" href="Coherence.Helpers.html#1361" class="Bound">h</a><a id="1362" class="Symbol">)</a> <a id="1364" class="Symbol">→</a> <a id="1366" class="Symbol">(</a><a id="1367" href="Coherence.Helpers.html#1361" class="Bound">h</a> <a id="1369" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="1371" href="Coherence.Helpers.html#1331" class="Bound">hᵢ</a><a id="1373" class="Symbol">)</a> <a id="1375" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="1377" class="Symbol">(</a><a id="1378" href="ComputationalModel.Serialization.html#245" class="Function Operator">∣</a> <a id="1380" href="Coherence.Helpers.html#1357" class="Bound">m</a> <a id="1382" href="ComputationalModel.Serialization.html#245" class="Function Operator">∣ᵐ</a> <a id="1385" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="1387" href="SecureCompilation.ModuleParameters.html#357" class="Field">η</a> <a id="1389" href="Agda.Builtin.Nat.html#319" class="Primitive Operator">+</a> <a id="1391" href="Coherence.Helpers.html#1326" class="Bound">Nᵢ</a><a id="1393" class="Symbol">))</a> <a id="1396" class="Bound">os</a> <a id="1399" href="Prelude.Decidable.Core.html#475" class="Function Operator">¿</a>
  <a id="1403" class="Symbol">...</a> <a id="1407" class="Symbol">|</a> <a id="1409" href="Relation.Nullary.html#1694" class="InductiveConstructor">no</a>  <a id="1413" href="Coherence.Helpers.html#1413" class="Bound">x∉</a> <a id="1416" class="Symbol">=</a> <a id="1418" href="Relation.Nullary.html#1694" class="InductiveConstructor">no</a> <a id="1421" class="Symbol">λ</a> <a id="1423" class="Symbol">(_</a> <a id="1426" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1428" class="Symbol">_</a> <a id="1430" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1432" href="Coherence.Helpers.html#1432" class="Bound">x∈</a> <a id="1435" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1437" href="Coherence.Helpers.html#1437" class="Bound">m≡</a><a id="1439" class="Symbol">)</a> <a id="1441" class="Symbol">→</a>
    <a id="1447" href="Data.List.Relation.Unary.All.html#5775" class="Function">L.All.lookup</a> <a id="1460" class="Symbol">(</a><a id="1461" href="Data.List.Relation.Unary.All.Properties.html#3427" class="Function">¬Any⇒All¬</a> <a id="1471" class="Bound">os</a> <a id="1474" href="Coherence.Helpers.html#1413" class="Bound">x∉</a><a id="1476" class="Symbol">)</a> <a id="1478" href="Coherence.Helpers.html#1432" class="Bound">x∈</a> <a id="1481" class="Symbol">(</a><a id="1482" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a> <a id="1487" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1489" href="Coherence.Helpers.html#1437" class="Bound">m≡</a><a id="1491" class="Symbol">)</a>
  <a id="1495" class="Symbol">...</a> <a id="1499" class="Symbol">|</a> <a id="1501" href="Relation.Nullary.html#1657" class="InductiveConstructor">yes</a> <a id="1505" href="Coherence.Helpers.html#1505" class="Bound">x∈</a>
    <a id="1512" class="Keyword">with</a> <a id="1517" href="Data.List.Relation.Unary.Any.html#1928" class="Function">L.Any.lookup</a> <a id="1530" href="Coherence.Helpers.html#1505" class="Bound">x∈</a> <a id="1533" class="Symbol">|</a> <a id="1535" href="Data.List.Membership.Propositional.Properties.html#11102" class="Function">∈-lookup</a> <a id="1544" class="Symbol">{</a><a id="1545" class="Argument">xs</a> <a id="1548" class="Symbol">=</a> <a id="1550" class="Bound">os</a><a id="1552" class="Symbol">}</a> <a id="1554" class="Symbol">(</a><a id="1555" href="Data.List.Relation.Unary.Any.html#1826" class="Function">L.Any.index</a> <a id="1567" href="Coherence.Helpers.html#1505" class="Bound">x∈</a><a id="1569" class="Symbol">)</a> <a id="1571" class="Symbol">|</a> <a id="1573" href="Data.List.Relation.Unary.Any.Properties.html#4337" class="Function">lookup-index</a> <a id="1586" href="Coherence.Helpers.html#1505" class="Bound">x∈</a>
  <a id="1591" class="Symbol">...</a> <a id="1595" class="Symbol">|</a> <a id="1597" href="Coherence.Helpers.html#1597" class="Bound">A</a> <a id="1599" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1601" href="Coherence.Helpers.html#1601" class="Bound">m</a> <a id="1603" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1605" class="Symbol">_</a> <a id="1607" class="Symbol">|</a> <a id="1609" href="Coherence.Helpers.html#1609" class="Bound">x∈</a> <a id="1612" class="Symbol">|</a> <a id="1614" href="Agda.Builtin.Equality.html#190" class="InductiveConstructor">refl</a> <a id="1619" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1621" href="Coherence.Helpers.html#1621" class="Bound">q</a> <a id="1623" class="Symbol">=</a> <a id="1625" href="Relation.Nullary.html#1657" class="InductiveConstructor">yes</a> <a id="1629" class="Symbol">(</a><a id="1630" href="Coherence.Helpers.html#1597" class="Bound">A</a> <a id="1632" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1634" href="Coherence.Helpers.html#1601" class="Bound">m</a> <a id="1636" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1638" href="Coherence.Helpers.html#1609" class="Bound">x∈</a> <a id="1641" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1643" href="Coherence.Helpers.html#1621" class="Bound">q</a><a id="1644" class="Symbol">)</a>

<a id="1647" class="Comment">-- Convenient wrappers for calling the BitML compiler.</a>
<a id="COMPILE"></a><a id="1702" href="Coherence.Helpers.html#1702" class="Function">COMPILE</a> <a id="1710" class="Symbol">:</a>
  <a id="1714" href="SymbolicModel.Mappings.html#1443" class="Function">𝔾</a> <a id="1716" href="BitML.Contracts.Types.html#2449" class="Generalizable">ad</a>
  <a id="1721" href="Prelude.InferenceRules.html#13085" class="Function Operator">───────────────────────────────────────────────</a>
  <a id="1771" href="Compiler.Outputs.html#206" class="Function">InitTx</a> <a id="1778" class="Symbol">(</a><a id="1779" href="BitML.Contracts.Types.html#2449" class="Generalizable">ad</a> <a id="1782" class="Symbol">.</a><a id="1783" href="BitML.Contracts.Types.html#2330" class="Field">G</a><a id="1784" class="Symbol">)</a> <a id="1786" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="1788" class="Symbol">(</a><a id="1789" href="BitML.Contracts.Subterms.html#647" class="Function">subterms</a> <a id="1798" href="BitML.Contracts.Types.html#2449" class="Generalizable">ad</a> <a id="1801" href="Prelude.Lists.Mappings.html#654" class="Function Operator">↦′</a> <a id="1804" href="Compiler.Outputs.html#504" class="Function">BranchTx</a> <a id="1813" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="1815" href="Compiler.Subterms.html#622" class="Field Operator">_∗</a><a id="1817" class="Symbol">)</a>
<a id="1819" href="Coherence.Helpers.html#1702" class="Function">COMPILE</a> <a id="1827" class="Symbol">{</a><a id="1828" class="Argument">ad</a> <a id="1831" class="Symbol">=</a> <a id="1833" href="Coherence.Helpers.html#1833" class="Bound">ad</a><a id="1835" class="Symbol">}</a> <a id="1837" class="Symbol">(</a><a id="1838" href="Coherence.Helpers.html#1838" class="Bound">vad</a> <a id="1842" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1844" href="Coherence.Helpers.html#1844" class="Bound">txout₀</a> <a id="1851" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1853" href="Coherence.Helpers.html#1853" class="Bound">sechash₀</a> <a id="1862" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1864" href="Coherence.Helpers.html#1864" class="Bound">κ₀</a><a id="1866" class="Symbol">)</a> <a id="1868" class="Symbol">=</a>
  <a id="1872" class="Keyword">let</a>
    <a id="1880" href="Coherence.Helpers.html#1880" class="Bound">K</a> <a id="1882" class="Symbol">:</a> <a id="1884" href="Compiler.Mappings.html#394" class="Function">𝕂</a> <a id="1886" class="Symbol">(</a><a id="1887" href="Coherence.Helpers.html#1833" class="Bound">ad</a> <a id="1890" class="Symbol">.</a><a id="1891" href="BitML.Contracts.Types.html#2330" class="Field">G</a><a id="1892" class="Symbol">)</a>
    <a id="1898" href="Coherence.Helpers.html#1880" class="Bound">K</a> <a id="1900" class="Symbol">{</a><a id="1901" href="Coherence.Helpers.html#1901" class="Bound">p</a><a id="1902" class="Symbol">}</a> <a id="1904" class="Symbol">_</a> <a id="1906" class="Symbol">=</a> <a id="1908" href="ComputationalModel.KeyPairs.html#225" class="Function">K̂</a> <a id="1911" href="Coherence.Helpers.html#1901" class="Bound">p</a>

    <a id="1918" href="Coherence.Helpers.html#1918" class="Bound">T</a> <a id="1920" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1922" href="Coherence.Helpers.html#1922" class="Bound">∀d</a> <a id="1925" class="Symbol">=</a> <a id="1927" href="Compiler.Translation.html#1219" class="Function">bitml-compiler</a> <a id="1942" class="Symbol">{</a><a id="1943" class="Argument">ad</a> <a id="1946" class="Symbol">=</a> <a id="1948" href="Coherence.Helpers.html#1833" class="Bound">ad</a><a id="1950" class="Symbol">}</a> <a id="1952" href="Coherence.Helpers.html#1838" class="Bound">vad</a> <a id="1956" href="Coherence.Helpers.html#1853" class="Bound">sechash₀</a> <a id="1965" href="Coherence.Helpers.html#1844" class="Bound">txout₀</a> <a id="1972" href="Coherence.Helpers.html#1880" class="Bound">K</a> <a id="1974" href="Coherence.Helpers.html#1864" class="Bound">κ₀</a>
  <a id="1979" class="Keyword">in</a>
    <a id="1986" href="Coherence.Helpers.html#1918" class="Bound">T</a> <a id="1988" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1990" href="Compiler.Subterms.html#2649" class="Function">weaken-sub</a> <a id="2001" class="Symbol">{</a><a id="2002" href="Coherence.Helpers.html#1833" class="Bound">ad</a><a id="2004" class="Symbol">}</a> <a id="2006" href="Coherence.Helpers.html#1922" class="Bound">∀d</a>

<a id="COMPILE-INIT"></a><a id="2010" href="Coherence.Helpers.html#2010" class="Function">COMPILE-INIT</a> <a id="2023" class="Symbol">:</a>
  <a id="2027" href="SymbolicModel.Mappings.html#1443" class="Function">𝔾</a> <a id="2029" href="BitML.Contracts.Types.html#2449" class="Generalizable">ad</a>
  <a id="2034" href="Prelude.InferenceRules.html#14273" class="Function Operator">──────────────</a>
  <a id="2051" href="Compiler.Outputs.html#206" class="Function">InitTx</a> <a id="2058" class="Symbol">(</a><a id="2059" href="BitML.Contracts.Types.html#2449" class="Generalizable">ad</a> <a id="2062" class="Symbol">.</a><a id="2063" href="BitML.Contracts.Types.html#2330" class="Field">G</a><a id="2064" class="Symbol">)</a>
<a id="2066" href="Coherence.Helpers.html#2010" class="Function">COMPILE-INIT</a> <a id="2079" class="Symbol">=</a> <a id="2081" href="Agda.Builtin.Sigma.html#234" class="Field">proj₁</a> <a id="2087" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="2089" href="Coherence.Helpers.html#1702" class="Function">COMPILE</a>

<a id="COMPILE-SUB"></a><a id="2098" href="Coherence.Helpers.html#2098" class="Function">COMPILE-SUB</a> <a id="2110" class="Symbol">:</a>
  <a id="2114" href="SymbolicModel.Mappings.html#1443" class="Function">𝔾</a> <a id="2116" href="BitML.Contracts.Types.html#2449" class="Generalizable">ad</a>
  <a id="2121" href="Prelude.InferenceRules.html#13902" class="Function Operator">────────────────────────────</a>
  <a id="2152" href="BitML.Contracts.Subterms.html#647" class="Function">subterms</a> <a id="2161" href="BitML.Contracts.Types.html#2449" class="Generalizable">ad</a> <a id="2164" href="Prelude.Lists.Mappings.html#654" class="Function Operator">↦′</a> <a id="2167" href="Compiler.Outputs.html#504" class="Function">BranchTx</a> <a id="2176" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="2178" href="Compiler.Subterms.html#622" class="Field Operator">_∗</a>
<a id="2181" href="Coherence.Helpers.html#2098" class="Function">COMPILE-SUB</a> <a id="2193" class="Symbol">=</a> <a id="2195" href="Agda.Builtin.Sigma.html#246" class="Field">proj₂</a> <a id="2201" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="2203" href="Coherence.Helpers.html#1702" class="Function">COMPILE</a>

<a id="COMPILE-ANCESTOR"></a><a id="2212" href="Coherence.Helpers.html#2212" class="Function">COMPILE-ANCESTOR</a> <a id="2229" class="Symbol">:</a> <a id="2231" class="Symbol">∀</a> <a id="2233" class="Symbol">{</a><a id="2234" href="Coherence.Helpers.html#2234" class="Bound">i</a> <a id="2236" class="Symbol">:</a> <a id="2238" href="Prelude.Lists.Indexed.html#542" class="Function">Index</a> <a id="2244" href="BitML.Contracts.Types.html#1252" class="Generalizable">c</a><a id="2245" class="Symbol">}</a> <a id="2247" class="Symbol">(</a><a id="2248" class="Keyword">open</a> <a id="2253" href="BitML.Contracts.ModuleMacros.html#549" class="Module">∣SELECT</a> <a id="2261" href="BitML.Contracts.Types.html#1252" class="Generalizable">c</a> <a id="2263" href="Coherence.Helpers.html#2234" class="Bound">i</a><a id="2264" class="Symbol">)</a> <a id="2266" class="Symbol">→</a>
  <a id="2270" href="Prelude.InferenceRules.html#56141" class="Function Operator">∙</a> <a id="2272" href="SymbolicModel.Run.Base.html#457" class="Generalizable">R</a> <a id="2274" href="SymbolicModel.Run.Base.html#1997" class="Function Operator">≈⋯</a> <a id="2277" href="BitML.Semantics.Configurations.Types.html#1138" class="Generalizable">Γ</a> <a id="2279" class="InductiveConstructor Operator">at</a> <a id="2282" href="BitML.BasicTypes.html#578" class="Generalizable">t</a>
  <a id="2286" href="Prelude.InferenceRules.html#56072" class="Function Operator">∙</a> <a id="2288" href="BitML.Semantics.Configurations.Types.html#597" class="InductiveConstructor Operator">⟨</a> <a id="2290" href="BitML.Contracts.Types.html#1252" class="Generalizable">c</a> <a id="2292" href="BitML.Semantics.Configurations.Types.html#597" class="InductiveConstructor Operator">,</a> <a id="2294" href="BitML.BasicTypes.html#443" class="Generalizable">v</a> <a id="2296" href="BitML.Semantics.Configurations.Types.html#597" class="InductiveConstructor Operator">⟩at</a> <a id="2300" href="BitML.BasicTypes.html#527" class="Generalizable">x</a> <a id="2302" href="BitML.Semantics.Configurations.Helpers.html#3965" class="Function Operator">∈ᶜ</a> <a id="2305" href="BitML.Semantics.Configurations.Types.html#1138" class="Generalizable">Γ</a>
  <a id="2309" href="Prelude.InferenceRules.html#56072" class="Function Operator">∙</a> <a id="2311" href="SymbolicModel.Mappings.html#872" class="Function">ℝ</a> <a id="2313" href="SymbolicModel.Run.Base.html#457" class="Generalizable">R</a>
    <a id="2319" href="Prelude.InferenceRules.html#13137" class="Function Operator">──────────────────────────────────────────────</a>
    <a id="2370" href="Compiler.Outputs.html#504" class="Function">BranchTx</a> <a id="2379" class="Symbol">(</a><a id="2380" href="BitML.Contracts.ModuleMacros.html#594" class="Function">d</a> <a id="2382" href="Compiler.Subterms.html#622" class="Field Operator">∗</a><a id="2383" class="Symbol">)</a> <a id="2385" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="2387" class="Symbol">(</a><a id="2388" href="BitML.Contracts.Collections.html#14015" class="Function">authDecorations</a> <a id="2404" href="BitML.Contracts.ModuleMacros.html#594" class="Function">d</a> <a id="2406" href="Prelude.Lists.Mappings.html#778" class="Function Operator">↦</a> <a id="2408" href="Bitcoin.Crypto.html#346" class="Record">KeyPair</a><a id="2415" class="Symbol">)</a>
<a id="2417" href="Coherence.Helpers.html#2212" class="Function">COMPILE-ANCESTOR</a> <a id="2434" class="Symbol">{</a><a id="2435" href="Coherence.Helpers.html#2435" class="Bound">c</a><a id="2436" class="Symbol">}{</a><a id="2438" href="Coherence.Helpers.html#2438" class="Bound">R</a><a id="2439" class="Symbol">}{</a><a id="2441" href="Coherence.Helpers.html#2441" class="Bound">Γ</a><a id="2442" class="Symbol">}{</a><a id="2444" href="Coherence.Helpers.html#2444" class="Bound">t</a><a id="2445" class="Symbol">}{</a><a id="2447" href="Coherence.Helpers.html#2447" class="Bound">v</a><a id="2448" class="Symbol">}{</a><a id="2450" href="Coherence.Helpers.html#2450" class="Bound">x</a><a id="2451" class="Symbol">}{</a><a id="2453" href="Coherence.Helpers.html#2453" class="Bound">i</a><a id="2454" class="Symbol">}</a> <a id="2456" href="Coherence.Helpers.html#2456" class="Bound">R≈</a> <a id="2459" href="Coherence.Helpers.html#2459" class="Bound">c∈</a> <a id="2462" href="Coherence.Helpers.html#2462" class="Bound">𝕣</a> <a id="2464" class="Symbol">=</a>
  <a id="2468" class="Keyword">let</a>
    <a id="2476" class="Comment">-- (ii) {G}C is the ancestor of ⟨C, v⟩ₓ in Rˢ</a>
    <a id="2526" href="Coherence.Helpers.html#2526" class="Bound">⟨G⟩C</a> <a id="2531" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2533" href="Coherence.Helpers.html#2533" class="Bound">vad</a> <a id="2537" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2539" href="Coherence.Helpers.html#2539" class="Bound">ad∈</a> <a id="2543" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2545" href="Coherence.Helpers.html#2545" class="Bound">c⊆</a> <a id="2548" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2550" href="Coherence.Helpers.html#2550" class="Bound">anc</a> <a id="2554" class="Symbol">=</a> <a id="2556" href="SymbolicModel.Properties.html#2197" class="Function">ANCESTOR</a> <a id="2565" class="Symbol">{</a><a id="2566" class="Argument">R</a> <a id="2568" class="Symbol">=</a> <a id="2570" href="Coherence.Helpers.html#2438" class="Bound">R</a><a id="2571" class="Symbol">}</a> <a id="2573" class="Symbol">{</a><a id="2574" class="Argument">Γ</a> <a id="2576" class="Symbol">=</a> <a id="2578" href="Coherence.Helpers.html#2441" class="Bound">Γ</a><a id="2579" class="Symbol">}</a> <a id="2581" href="Coherence.Helpers.html#2456" class="Bound">R≈</a> <a id="2584" href="Coherence.Helpers.html#2459" class="Bound">c∈</a>
    <a id="2591" class="Keyword">open</a> <a id="2596" href="BitML.Contracts.ModuleMacros.html#761" class="Module">∣AD</a> <a id="2600" href="Coherence.Helpers.html#2526" class="Bound">⟨G⟩C</a><a id="2604" class="Symbol">;</a> <a id="2606" class="Keyword">open</a> <a id="2611" href="BitML.Contracts.ModuleMacros.html#549" class="Module">∣SELECT</a> <a id="2619" href="Coherence.Helpers.html#2435" class="Bound">c</a> <a id="2621" href="Coherence.Helpers.html#2453" class="Bound">i</a><a id="2622" class="Symbol">;</a> <a id="2624" class="Keyword">open</a> <a id="2629" href="SymbolicModel.Mappings.html#897" class="Module">ℝ</a> <a id="2631" href="Coherence.Helpers.html#2462" class="Bound">𝕣</a>

    <a id="2638" href="Coherence.Helpers.html#2638" class="Bound">d∈</a> <a id="2641" class="Symbol">:</a> <a id="2643" href="BitML.Contracts.ModuleMacros.html#594" class="Function">d</a> <a id="2645" href="Data.List.Membership.Setoid.html#896" class="Function Operator">∈</a> <a id="2647" href="BitML.Contracts.Subterms.html#647" class="Function">subterms</a> <a id="2656" href="Coherence.Helpers.html#2526" class="Bound">⟨G⟩C</a>
    <a id="2665" href="Coherence.Helpers.html#2638" class="Bound">d∈</a> <a id="2668" class="Symbol">=</a> <a id="2670" href="Coherence.Helpers.html#2545" class="Bound">c⊆</a> <a id="2673" class="Symbol">(</a><a id="2674" href="Data.List.Membership.Propositional.Properties.html#11102" class="Function">L.Mem.∈-lookup</a> <a id="2689" href="Coherence.Helpers.html#2453" class="Bound">i</a><a id="2690" class="Symbol">)</a>

    <a id="2697" href="Coherence.Helpers.html#2697" class="Bound">A∈</a> <a id="2700" class="Symbol">:</a> <a id="2702" href="BitML.Contracts.Collections.html#14015" class="Function">authDecorations</a> <a id="2718" href="BitML.Contracts.ModuleMacros.html#594" class="Function">d</a> <a id="2720" href="Data.List.Relation.Binary.Subset.Setoid.html#748" class="Function Operator">⊆</a> <a id="2722" href="BitML.Contracts.ModuleMacros.html#813" class="Function">partG</a>
    <a id="2732" href="Coherence.Helpers.html#2697" class="Bound">A∈</a> <a id="2735" class="Symbol">=</a> <a id="2737" href="Prelude.Lists.Dec.html#4157" class="Function">∈-nub⁺</a> <a id="2744" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="2746" href="BitML.Contracts.Subterms.html#9999" class="Function">subterms-part⊆ᵃ</a> <a id="2762" href="Coherence.Helpers.html#2533" class="Bound">vad</a> <a id="2766" href="Coherence.Helpers.html#2638" class="Bound">d∈</a> <a id="2769" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="2771" href="BitML.Contracts.Collections.html#14174" class="Function">auth⊆part</a> <a id="2781" class="Symbol">{</a><a id="2782" class="Argument">d</a> <a id="2784" class="Symbol">=</a> <a id="2786" href="BitML.Contracts.ModuleMacros.html#594" class="Function">d</a><a id="2787" class="Symbol">}</a>

    <a id="2794" class="Symbol">_</a> <a id="2796" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2798" href="Coherence.Helpers.html#2798" class="Bound">∀d∗</a> <a id="2802" class="Symbol">=</a> <a id="2804" href="Coherence.Helpers.html#1702" class="Function">COMPILE</a> <a id="2812" class="Symbol">(</a><a id="2813" href="SymbolicModel.Helpers.html#1902" class="Function">LIFTᶜ</a> <a id="2819" href="Coherence.Helpers.html#2462" class="Bound">𝕣</a> <a id="2821" href="Coherence.Helpers.html#2550" class="Bound">anc</a><a id="2824" class="Symbol">)</a>
  <a id="2828" class="Keyword">in</a>
    <a id="2835" href="Coherence.Helpers.html#2798" class="Bound">∀d∗</a> <a id="2839" href="Coherence.Helpers.html#2638" class="Bound">d∈</a> <a id="2842" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2844" href="SymbolicModel.Mappings.html#986" class="Field">κ′</a> <a id="2847" href="Coherence.Helpers.html#2539" class="Bound">ad∈</a> <a id="2851" href="Coherence.Helpers.html#2638" class="Bound">d∈</a> <a id="2854" href="Function.Base.html#1040" class="Function Operator">∘</a> <a id="2856" href="Coherence.Helpers.html#2697" class="Bound">A∈</a>
</pre></body></html>