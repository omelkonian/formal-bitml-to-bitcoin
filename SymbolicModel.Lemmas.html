<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>SymbolicModel.Lemmas</title><link rel="stylesheet" href="css/Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- Lemmas related to BitML&#39;s symbolic model.</a>
<a id="119" class="Comment">------------------------------------------------------------------------</a>
<a id="192" class="Symbol">{-#</a> <a id="196" class="Keyword">OPTIONS</a> <a id="204" class="Pragma">--allow-unsolved-metas</a> <a id="227" class="Symbol">#-}</a>

<a id="232" class="Keyword">open</a> <a id="237" class="Keyword">import</a> <a id="244" href="Function.html" class="Module">Function</a> <a id="253" class="Keyword">using</a> <a id="259" class="Symbol">(</a><a id="260" href="Function.Base.html#4269" class="Function Operator">_∋_</a><a id="263" class="Symbol">;</a> <a id="265" href="Function.Base.html#992" class="Function Operator">_∘_</a><a id="268" class="Symbol">;</a> <a id="270" href="Function.Base.html#3544" class="Function Operator">case_of_</a><a id="278" class="Symbol">)</a>

<a id="281" class="Keyword">open</a> <a id="286" class="Keyword">import</a> <a id="293" href="Data.Empty.html" class="Module">Data.Empty</a>   <a id="306" class="Keyword">using</a> <a id="312" class="Symbol">(</a><a id="313" href="Data.Empty.html#526" class="Datatype">⊥</a><a id="314" class="Symbol">;</a> <a id="316" href="Data.Empty.html#628" class="Function">⊥-elim</a><a id="322" class="Symbol">)</a>
<a id="324" class="Keyword">open</a> <a id="329" class="Keyword">import</a> <a id="336" href="Data.Unit.html" class="Module">Data.Unit</a>    <a id="349" class="Keyword">using</a> <a id="355" class="Symbol">(</a><a id="356" href="Agda.Builtin.Unit.html#164" class="Record">⊤</a><a id="357" class="Symbol">;</a> <a id="359" href="Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a><a id="361" class="Symbol">)</a>
<a id="363" class="Keyword">open</a> <a id="368" class="Keyword">import</a> <a id="375" href="Data.Product.html" class="Module">Data.Product</a> <a id="388" class="Keyword">using</a> <a id="394" class="Symbol">(</a><a id="395" href="Data.Product.html#1369" class="Function">∃</a><a id="396" class="Symbol">;</a> <a id="398" href="Data.Product.html#1788" class="Function">∃-syntax</a><a id="406" class="Symbol">;</a> <a id="408" href="Agda.Builtin.Sigma.html#166" class="Record">Σ</a><a id="409" class="Symbol">;</a> <a id="411" href="Data.Product.html#916" class="Function">Σ-syntax</a><a id="419" class="Symbol">;</a> <a id="421" href="Data.Product.html#1167" class="Function Operator">_×_</a><a id="424" class="Symbol">;</a> <a id="426" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">_,_</a><a id="429" class="Symbol">;</a> <a id="431" href="Agda.Builtin.Sigma.html#252" class="Field">proj₁</a><a id="436" class="Symbol">;</a> <a id="438" href="Agda.Builtin.Sigma.html#264" class="Field">proj₂</a><a id="443" class="Symbol">;</a> <a id="445" href="Data.Product.html#2574" class="Function">map₁</a><a id="449" class="Symbol">;</a> <a id="451" href="Data.Product.html#2624" class="Function">map₂</a><a id="455" class="Symbol">)</a>
<a id="457" class="Keyword">open</a> <a id="462" class="Keyword">import</a> <a id="469" href="Data.Sum.html" class="Module">Data.Sum</a>     <a id="482" class="Keyword">using</a> <a id="488" class="Symbol">(</a><a id="489" href="Data.Sum.Base.html#728" class="Datatype Operator">_⊎_</a><a id="492" class="Symbol">;</a> <a id="494" href="Data.Sum.Base.html#778" class="InductiveConstructor">inj₁</a><a id="498" class="Symbol">;</a> <a id="500" href="Data.Sum.Base.html#803" class="InductiveConstructor">inj₂</a><a id="504" class="Symbol">)</a>
<a id="506" class="Keyword">open</a> <a id="511" class="Keyword">import</a> <a id="518" href="Data.Nat.html" class="Module">Data.Nat</a>     <a id="531" class="Keyword">using</a> <a id="537" class="Symbol">(</a><a id="538" href="Data.Nat.Base.html#1111" class="Function Operator">_&gt;_</a><a id="541" class="Symbol">;</a> <a id="543" href="Data.Nat.Base.html#1081" class="Function Operator">_≥_</a><a id="546" class="Symbol">)</a>
<a id="548" class="Keyword">open</a> <a id="553" class="Keyword">import</a> <a id="560" href="Data.Fin.html" class="Module">Data.Fin</a>     <a id="573" class="Keyword">using</a> <a id="579" class="Symbol">(</a><a id="580" href="Data.Fin.Base.html#1066" class="Datatype">Fin</a><a id="583" class="Symbol">;</a> <a id="585" href="Data.Fin.Base.html#1807" class="Function">fromℕ</a><a id="590" class="Symbol">;</a> <a id="592" href="Data.Fin.Base.html#1192" class="Function">toℕ</a><a id="595" class="Symbol">)</a>
  <a id="599" class="Keyword">renaming</a> <a id="608" class="Symbol">(</a><a id="609" href="Data.Fin.Base.html#1088" class="InductiveConstructor">zero</a> <a id="614" class="Symbol">to</a> <a id="Base.Fin.zero"></a><a id="617" href="SymbolicModel.Lemmas.html#617" class="InductiveConstructor">0ᶠ</a><a id="619" class="Symbol">;</a> <a id="621" href="Data.Fin.Base.html#1119" class="InductiveConstructor">suc</a> <a id="625" class="Symbol">to</a> <a id="Base.Fin.suc"></a><a id="628" href="SymbolicModel.Lemmas.html#628" class="InductiveConstructor">sucᶠ</a><a id="632" class="Symbol">;</a> <a id="634" href="Data.Fin.Properties.html#2258" class="Function Operator">_≟_</a> <a id="638" class="Symbol">to</a> <a id="Properties._≟_"></a><a id="641" href="SymbolicModel.Lemmas.html#641" class="Function Operator">_≟ᶠ_</a><a id="645" class="Symbol">)</a>
<a id="647" class="Keyword">open</a> <a id="652" class="Keyword">import</a> <a id="659" href="Data.String.html" class="Module">Data.String</a>  <a id="672" class="Keyword">using</a> <a id="678" class="Symbol">(</a><a id="679" href="Agda.Builtin.String.html#274" class="Postulate">String</a><a id="685" class="Symbol">)</a>
  <a id="689" class="Keyword">renaming</a> <a id="698" class="Symbol">(</a><a id="699" href="Data.String.Base.html#2141" class="Function">length</a> <a id="706" class="Symbol">to</a> <a id="Base.length"></a><a id="709" href="SymbolicModel.Lemmas.html#709" class="Function">lengthₛ</a><a id="716" class="Symbol">)</a>

<a id="719" class="Keyword">open</a> <a id="724" class="Keyword">import</a> <a id="731" href="Data.List.html" class="Module">Data.List</a> <a id="741" class="Keyword">using</a> <a id="747" class="Symbol">(</a><a id="748" href="Agda.Builtin.List.html#148" class="Datatype">List</a><a id="752" class="Symbol">;</a> <a id="754" href="Data.List.Base.html#9701" class="InductiveConstructor">[]</a><a id="756" class="Symbol">;</a> <a id="758" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">_∷_</a><a id="761" class="Symbol">;</a> <a id="763" href="Data.List.Base.html#4458" class="Function Operator">[_]</a><a id="766" class="Symbol">;</a> <a id="768" href="Data.List.Base.html#4297" class="Function">length</a><a id="774" class="Symbol">;</a> <a id="776" href="Data.List.Base.html#1497" class="Function">map</a><a id="779" class="Symbol">;</a> <a id="781" href="Data.List.Base.html#3883" class="Function">concatMap</a><a id="790" class="Symbol">;</a> <a id="792" href="Data.List.Base.html#1763" class="Function Operator">_++_</a><a id="796" class="Symbol">;</a> <a id="798" href="Data.List.Base.html#3243" class="Function">zip</a><a id="801" class="Symbol">)</a>
<a id="803" class="Keyword">open</a> <a id="808" class="Keyword">import</a> <a id="815" href="Data.List.Membership.Propositional.html" class="Module">Data.List.Membership.Propositional</a> <a id="850" class="Keyword">using</a> <a id="856" class="Symbol">(</a><a id="857" href="Data.List.Membership.Setoid.html#882" class="Function Operator">_∈_</a><a id="860" class="Symbol">;</a> <a id="862" href="Data.List.Membership.Setoid.html#931" class="Function Operator">_∉_</a><a id="865" class="Symbol">;</a> <a id="867" href="Data.List.Membership.Setoid.html#1123" class="Function">mapWith∈</a><a id="875" class="Symbol">)</a>
<a id="877" class="Keyword">open</a> <a id="882" class="Keyword">import</a> <a id="889" href="Data.List.Relation.Unary.All.html" class="Module">Data.List.Relation.Unary.All</a> <a id="918" class="Symbol">as</a> <a id="921" class="Module">All</a> <a id="925" class="Keyword">using</a> <a id="931" class="Symbol">(</a><a id="932" href="Data.List.Relation.Unary.All.html#1274" class="Datatype">All</a><a id="935" class="Symbol">)</a>
<a id="937" class="Keyword">open</a> <a id="942" class="Keyword">import</a> <a id="949" href="Data.List.Relation.Unary.Any.html" class="Module">Data.List.Relation.Unary.Any</a> <a id="978" class="Keyword">using</a> <a id="984" class="Symbol">(</a><a id="985" href="Data.List.Relation.Unary.Any.html#1111" class="Datatype">Any</a><a id="988" class="Symbol">)</a>

<a id="991" class="Keyword">import</a> <a id="998" href="Data.Vec.html" class="Module">Data.Vec</a> <a id="1007" class="Symbol">as</a> <a id="1010" class="Module">V</a>

<a id="1013" class="Keyword">open</a> <a id="1018" class="Keyword">import</a> <a id="1025" href="Data.Maybe.html" class="Module">Data.Maybe</a> <a id="1036" class="Keyword">using</a> <a id="1042" class="Symbol">(</a><a id="1043" href="Data.Maybe.Base.html#838" class="Datatype">Maybe</a><a id="1048" class="Symbol">;</a> <a id="1050" href="Data.Maybe.Base.html#892" class="InductiveConstructor">just</a><a id="1054" class="Symbol">;</a> <a id="1056" href="Data.Maybe.Base.html#872" class="InductiveConstructor">nothing</a><a id="1063" class="Symbol">)</a>
<a id="1065" class="Keyword">open</a> <a id="1070" class="Keyword">import</a> <a id="1077" href="Data.Maybe.Relation.Unary.All.html" class="Module">Data.Maybe.Relation.Unary.All</a> <a id="1107" class="Keyword">using</a> <a id="1113" class="Symbol">()</a> <a id="1116" class="Keyword">renaming</a> <a id="1125" class="Symbol">(</a><a id="1126" href="Data.Maybe.Relation.Unary.All.html#943" class="Datatype">All</a> <a id="1130" class="Symbol">to</a> <a id="Relation.Unary.All.All"></a><a id="1133" href="SymbolicModel.Lemmas.html#1133" class="Datatype">Allₘ</a><a id="1137" class="Symbol">)</a>

<a id="1140" class="Keyword">open</a> <a id="1145" class="Keyword">import</a> <a id="1152" href="Relation.Binary.html" class="Module">Relation.Binary</a>                       <a id="1190" class="Keyword">using</a> <a id="1196" class="Symbol">(</a><a id="1197" href="Relation.Binary.Definitions.html#4575" class="Function">Decidable</a><a id="1206" class="Symbol">)</a>
<a id="1208" class="Keyword">open</a> <a id="1213" class="Keyword">import</a> <a id="1220" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="1258" class="Keyword">using</a> <a id="1264" class="Symbol">(</a><a id="1265" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">_≡_</a><a id="1268" class="Symbol">;</a> <a id="1270" href="Relation.Binary.PropositionalEquality.Core.html#840" class="Function Operator">_≢_</a><a id="1273" class="Symbol">;</a> <a id="1275" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="1279" class="Symbol">;</a> <a id="1281" href="Relation.Binary.PropositionalEquality.Core.html#1131" class="Function">cong</a><a id="1285" class="Symbol">;</a> <a id="1287" href="Relation.Binary.PropositionalEquality.Core.html#980" class="Function">sym</a><a id="1290" class="Symbol">;</a> <a id="1292" href="Relation.Binary.PropositionalEquality.Core.html#1025" class="Function">trans</a><a id="1297" class="Symbol">)</a> <a id="1299" class="Comment">-- ; inspect)</a>

<a id="1314" class="Keyword">open</a> <a id="1319" class="Keyword">import</a> <a id="1326" href="Prelude.Lists.html" class="Module">Prelude.Lists</a>
<a id="1340" class="Keyword">import</a> <a id="1347" href="Prelude.Set%2527.html" class="Module">Prelude.Set&#39;</a> <a id="1360" class="Symbol">as</a> <a id="1363" class="Module">SET</a>

<a id="1368" class="Keyword">open</a> <a id="1373" class="Keyword">import</a> <a id="1380" href="BitML.BasicTypes.html" class="Module">BitML.BasicTypes</a>

<a id="1398" class="Keyword">module</a> <a id="1405" href="SymbolicModel.Lemmas.html" class="Module">SymbolicModel.Lemmas</a>
  <a id="1428" class="Symbol">(</a><a id="1429" href="SymbolicModel.Lemmas.html#1429" class="Bound">Participant</a> <a id="1441" class="Symbol">:</a> <a id="1443" class="PrimitiveType">Set</a><a id="1446" class="Symbol">)</a>
  <a id="1450" class="Symbol">(</a><a id="1451" href="SymbolicModel.Lemmas.html#1451" class="Bound Operator">_≟ₚ_</a> <a id="1456" class="Symbol">:</a> <a id="1458" href="Relation.Binary.Definitions.html#4575" class="Function">Decidable</a> <a id="1468" class="Symbol">{</a><a id="1469" class="Argument">A</a> <a id="1471" class="Symbol">=</a> <a id="1473" href="SymbolicModel.Lemmas.html#1429" class="Bound">Participant</a><a id="1484" class="Symbol">}</a> <a id="1486" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">_≡_</a><a id="1489" class="Symbol">)</a>
  <a id="1493" class="Symbol">(</a><a id="1494" href="SymbolicModel.Lemmas.html#1494" class="Bound">Honest</a> <a id="1501" class="Symbol">:</a> <a id="1503" href="Data.Product.html#916" class="Function">Σ[</a> <a id="1506" href="SymbolicModel.Lemmas.html#1506" class="Bound">ps</a> <a id="1509" href="Data.Product.html#916" class="Function">∈</a> <a id="1511" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="1516" href="SymbolicModel.Lemmas.html#1429" class="Bound">Participant</a> <a id="1528" href="Data.Product.html#916" class="Function">]</a> <a id="1530" class="Symbol">(</a><a id="1531" href="Data.List.Base.html#4297" class="Function">length</a> <a id="1538" href="SymbolicModel.Lemmas.html#1506" class="Bound">ps</a> <a id="1541" href="Data.Nat.Base.html#1111" class="Function Operator">&gt;</a> <a id="1543" class="Number">0</a><a id="1544" class="Symbol">))</a>
  <a id="1549" class="Keyword">where</a>

<a id="1556" class="Keyword">open</a> <a id="1561" class="Keyword">import</a> <a id="1568" href="BitML.Contracts.Types.html" class="Module">BitML.Contracts.Types</a>                  <a id="1607" href="SymbolicModel.Lemmas.html#1429" class="Bound">Participant</a> <a id="1619" href="SymbolicModel.Lemmas.html#1451" class="Bound Operator">_≟ₚ_</a> <a id="1624" href="SymbolicModel.Lemmas.html#1494" class="Bound">Honest</a>
<a id="1631" class="Keyword">open</a> <a id="1636" class="Keyword">import</a> <a id="1643" href="BitML.Contracts.DecidableEquality.html" class="Module">BitML.Contracts.DecidableEquality</a>      <a id="1682" href="SymbolicModel.Lemmas.html#1429" class="Bound">Participant</a> <a id="1694" href="SymbolicModel.Lemmas.html#1451" class="Bound Operator">_≟ₚ_</a> <a id="1699" href="SymbolicModel.Lemmas.html#1494" class="Bound">Honest</a>
<a id="1706" class="Keyword">open</a> <a id="1711" class="Keyword">import</a> <a id="1718" href="BitML.Semantics.Actions.Types.html" class="Module">BitML.Semantics.Actions.Types</a>          <a id="1757" href="SymbolicModel.Lemmas.html#1429" class="Bound">Participant</a> <a id="1769" href="SymbolicModel.Lemmas.html#1451" class="Bound Operator">_≟ₚ_</a> <a id="1774" href="SymbolicModel.Lemmas.html#1494" class="Bound">Honest</a>
<a id="1781" class="Keyword">open</a> <a id="1786" class="Keyword">import</a> <a id="1793" href="BitML.Semantics.Configurations.Types.html" class="Module">BitML.Semantics.Configurations.Types</a>   <a id="1832" href="SymbolicModel.Lemmas.html#1429" class="Bound">Participant</a> <a id="1844" href="SymbolicModel.Lemmas.html#1451" class="Bound Operator">_≟ₚ_</a> <a id="1849" href="SymbolicModel.Lemmas.html#1494" class="Bound">Honest</a>
<a id="1856" class="Keyword">open</a> <a id="1861" class="Keyword">import</a> <a id="1868" href="BitML.Semantics.Configurations.Helpers.html" class="Module">BitML.Semantics.Configurations.Helpers</a> <a id="1907" href="SymbolicModel.Lemmas.html#1429" class="Bound">Participant</a> <a id="1919" href="SymbolicModel.Lemmas.html#1451" class="Bound Operator">_≟ₚ_</a> <a id="1924" href="SymbolicModel.Lemmas.html#1494" class="Bound">Honest</a>
<a id="1931" class="Keyword">open</a> <a id="1936" class="Keyword">import</a> <a id="1943" href="BitML.Semantics.InferenceRules.html" class="Module">BitML.Semantics.InferenceRules</a>         <a id="1982" href="SymbolicModel.Lemmas.html#1429" class="Bound">Participant</a> <a id="1994" href="SymbolicModel.Lemmas.html#1451" class="Bound Operator">_≟ₚ_</a> <a id="1999" href="SymbolicModel.Lemmas.html#1494" class="Bound">Honest</a>
<a id="2006" class="Keyword">open</a> <a id="2011" class="Keyword">import</a> <a id="2018" href="BitML.Semantics.Labels.Types.html" class="Module">BitML.Semantics.Labels.Types</a>           <a id="2057" href="SymbolicModel.Lemmas.html#1429" class="Bound">Participant</a> <a id="2069" href="SymbolicModel.Lemmas.html#1451" class="Bound Operator">_≟ₚ_</a> <a id="2074" href="SymbolicModel.Lemmas.html#1494" class="Bound">Honest</a>

<a id="2082" class="Keyword">open</a> <a id="2087" class="Keyword">import</a> <a id="2094" href="SymbolicModel.Strategy.html" class="Module">SymbolicModel.Strategy</a> <a id="2117" href="SymbolicModel.Lemmas.html#1429" class="Bound">Participant</a> <a id="2129" href="SymbolicModel.Lemmas.html#1451" class="Bound Operator">_≟ₚ_</a> <a id="2134" href="SymbolicModel.Lemmas.html#1494" class="Bound">Honest</a> <a id="2141" class="Symbol">as</a> <a id="SM"></a><a id="2144" href="SymbolicModel.Lemmas.html#2144" class="Module">SM</a>

<a id="2148" class="Comment">----------------------------------------</a>
<a id="2189" class="Comment">-- Lemma 3</a>

<a id="2201" class="Keyword">module</a> <a id="2208" href="SymbolicModel.Lemmas.html#2208" class="Module">_</a> <a id="2210" class="Symbol">(</a><a id="2211" href="SymbolicModel.Lemmas.html#2211" class="Bound">α≢₁</a> <a id="2215" class="Symbol">:</a> <a id="2217" class="Symbol">∀</a> <a id="2219" href="SymbolicModel.Lemmas.html#2219" class="Bound">A</a> <a id="2221" href="SymbolicModel.Lemmas.html#2221" class="Bound">s</a>      <a id="2228" class="Symbol">→</a> <a id="2230" href="BitML.Semantics.Labels.Types.html#2506" class="Generalizable">α</a> <a id="2232" href="Relation.Binary.PropositionalEquality.Core.html#840" class="Function Operator">≢</a> <a id="2234" href="BitML.Semantics.Labels.Types.html#2051" class="InductiveConstructor Operator">auth-rev[</a> <a id="2244" href="SymbolicModel.Lemmas.html#2219" class="Bound">A</a> <a id="2246" href="BitML.Semantics.Labels.Types.html#2051" class="InductiveConstructor Operator">,</a> <a id="2248" href="SymbolicModel.Lemmas.html#2221" class="Bound">s</a> <a id="2250" href="BitML.Semantics.Labels.Types.html#2051" class="InductiveConstructor Operator">]</a><a id="2251" class="Symbol">)</a>
         <a id="2262" class="Symbol">(</a><a id="2263" href="SymbolicModel.Lemmas.html#2263" class="Bound">α≢₂</a> <a id="2267" class="Symbol">:</a> <a id="2269" class="Symbol">∀</a> <a id="2271" href="SymbolicModel.Lemmas.html#2271" class="Bound">A</a> <a id="2273" href="SymbolicModel.Lemmas.html#2273" class="Bound">⟨G⟩C</a> <a id="2278" href="SymbolicModel.Lemmas.html#2278" class="Bound">Δ</a> <a id="2280" class="Symbol">→</a> <a id="2282" href="BitML.Semantics.Labels.Types.html#2506" class="Generalizable">α</a> <a id="2284" href="Relation.Binary.PropositionalEquality.Core.html#840" class="Function Operator">≢</a> <a id="2286" href="BitML.Semantics.Labels.Types.html#1721" class="InductiveConstructor Operator">auth-commit[</a> <a id="2299" href="SymbolicModel.Lemmas.html#2271" class="Bound">A</a> <a id="2301" href="BitML.Semantics.Labels.Types.html#1721" class="InductiveConstructor Operator">,</a> <a id="2303" href="SymbolicModel.Lemmas.html#2273" class="Bound">⟨G⟩C</a> <a id="2308" href="BitML.Semantics.Labels.Types.html#1721" class="InductiveConstructor Operator">,</a> <a id="2310" href="SymbolicModel.Lemmas.html#2278" class="Bound">Δ</a> <a id="2312" href="BitML.Semantics.Labels.Types.html#1721" class="InductiveConstructor Operator">]</a><a id="2313" class="Symbol">)</a> <a id="2315" class="Keyword">where</a>

  <a id="2324" href="SymbolicModel.Lemmas.html#2324" class="Function">strip-preserves-semantics</a> <a id="2350" class="Symbol">:</a>
      <a id="2358" class="Symbol">(</a> <a id="2360" class="Symbol">∀</a> <a id="2362" href="SymbolicModel.Lemmas.html#2362" class="Bound">T′</a> <a id="2365" class="Symbol">→</a> <a id="2367" href="SymbolicModel.Strategy.html#1923" class="Generalizable">R</a>   <a id="2371" href="SymbolicModel.Strategy.html#2764" class="Function Operator">——→[</a> <a id="2376" href="SymbolicModel.Lemmas.html#2230" class="Bound">α</a> <a id="2378" href="SymbolicModel.Strategy.html#2764" class="Function Operator">]</a> <a id="2380" href="SymbolicModel.Lemmas.html#2362" class="Bound">T′</a>
               <a id="2398" class="Comment">--------------------</a>
             <a id="2432" class="Symbol">→</a> <a id="2434" href="SymbolicModel.Strategy.html#1923" class="Generalizable">R</a> <a id="2436" href="SymbolicModel.Strategy.html#2710" class="Function Operator">∗</a> <a id="2438" href="SymbolicModel.Strategy.html#2764" class="Function Operator">——→[</a> <a id="2443" href="SymbolicModel.Lemmas.html#2230" class="Bound">α</a> <a id="2445" href="SymbolicModel.Strategy.html#2764" class="Function Operator">]</a> <a id="2447" href="SymbolicModel.Lemmas.html#2362" class="Bound">T′</a> <a id="2450" href="SymbolicModel.Strategy.html#2498" class="Function Operator">∗ᵗ</a> <a id="2453" class="Symbol">)</a>

    <a id="2460" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="2462" class="Symbol">(</a> <a id="2464" class="Symbol">∀</a> <a id="2466" href="SymbolicModel.Lemmas.html#2466" class="Bound">T′</a> <a id="2469" class="Symbol">→</a> <a id="2471" href="SymbolicModel.Strategy.html#1923" class="Generalizable">R</a> <a id="2473" href="SymbolicModel.Strategy.html#2710" class="Function Operator">∗</a> <a id="2475" href="SymbolicModel.Strategy.html#2764" class="Function Operator">——→[</a> <a id="2480" href="SymbolicModel.Lemmas.html#2230" class="Bound">α</a> <a id="2482" href="SymbolicModel.Strategy.html#2764" class="Function Operator">]</a> <a id="2484" href="SymbolicModel.Lemmas.html#2466" class="Bound">T′</a>
               <a id="2502" class="Comment">--------------------------</a>
             <a id="2542" class="Symbol">→</a> <a id="2544" href="Data.Product.html#1788" class="Function">∃[</a> <a id="2547" href="SymbolicModel.Lemmas.html#2547" class="Bound">T″</a> <a id="2550" href="Data.Product.html#1788" class="Function">]</a> <a id="2552" class="Symbol">(</a> <a id="2554" class="Symbol">(</a><a id="2555" href="SymbolicModel.Strategy.html#1923" class="Generalizable">R</a> <a id="2557" href="SymbolicModel.Strategy.html#2764" class="Function Operator">——→[</a> <a id="2562" href="SymbolicModel.Lemmas.html#2230" class="Bound">α</a> <a id="2564" href="SymbolicModel.Strategy.html#2764" class="Function Operator">]</a> <a id="2566" href="SymbolicModel.Lemmas.html#2547" class="Bound">T″</a><a id="2568" class="Symbol">)</a>
                       <a id="2593" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="2595" href="SymbolicModel.Lemmas.html#2466" class="Bound">T′</a> <a id="2598" href="SymbolicModel.Strategy.html#2498" class="Function Operator">∗ᵗ</a> <a id="2601" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="2603" href="SymbolicModel.Lemmas.html#2547" class="Bound">T″</a> <a id="2606" href="SymbolicModel.Strategy.html#2498" class="Function Operator">∗ᵗ</a> <a id="2609" class="Symbol">))</a>
  <a id="2614" href="SymbolicModel.Lemmas.html#2324" class="Function">strip-preserves-semantics</a> <a id="2640" class="Symbol">=</a> <a id="2642" class="Symbol">{!!}</a>

<a id="2648" class="Comment">{-
  strip-preserves-semantics {R = R} = pr₁ , pr₂
    where
      strip-→ : Γ —→[ α ] Γ′
            ------------------------------------------------
          → Γ ∗ᶜ —→[ α ] Γ′ ∗ᶜ
      strip-→ ([C-AuthRev] {s = s} {A = A} _)
        = ⊥-elim (α≢₁ A s refl)
      strip-→ ([C-AuthCommit] {A = A} {ci = ci} {pi = pi} {ad = ad} {secrets = secrets}  _ _)
        = ⊥-elim (α≢₂ A (ci , pi , ad) secrets refl)

      strip-→ [C-Withdraw]          = [C-Withdraw]
      strip-→ ([C-AuthControl] x)   = [C-AuthControl] x
      strip-→ [DEP-AuthJoin]        = [DEP-AuthJoin]
      strip-→ [DEP-Join]            = [DEP-Join]
      strip-→ [DEP-AuthDivide]      = [DEP-AuthDivide]
      strip-→ [DEP-Divide]          = [DEP-Divide]
      strip-→ [DEP-AuthDonate]      = [DEP-AuthDonate]
      strip-→ [DEP-Donate]          = [DEP-Donate]
      strip-→ [DEP-AuthDestroy]     = [DEP-AuthDestroy]
      strip-→ [DEP-Destroy]         = [DEP-Destroy]
      strip-→ ([C-Advertise] x x₁)  = [C-Advertise] x x₁

      strip-→ ([C-AuthInit] {dsˡ = dsˡ} {dsʳ = dsʳ} {ad = ad} {Γ = Γ} {p = refl} x x₁) =
        [C-AuthInit] {dsˡ = dsˡ} {dsʳ = dsʳ} {p = refl} x (strip-committedParticipants₂ {Γp = Γ} {ad = ad} x₁)

      strip-→ ([C-Init] {ad = ad} {Δ = Δ} x x₁ x₂) =
        [C-Init] x (strip-committedParticipants₂ {Γp = Δ} {ad = ad} x₁)
                   (strip-spentForStipulation₂ {ad = ad} {Δ = Δ} x₂)

      strip-→ ([C-Split] {vs = vs} {Γ = Γ} {cases = cases} refl refl)
        rewrite strip-cases {cs′ = casesToContracts cases} {Γ = Γ}
              = [C-Split] refl refl

      strip-→ ([C-PutRev] {Γ = Γ} {ds′ = ds′} {Δ = ss} pr x x₁ x₂)
        rewrite strip-ds {ds′ = ds′} {Γ = V.toList ss ∣∣ˢˢ Γ}
              | strip-ss {ss = V.toList ss} {Γ = Γ}
              = [C-PutRev] {Γ = Γ ∗ᶜ} {ds′ = ds′} {Δ = ss} pr x x₁ x₂

      strip-→ ([C-Control] {contract = c} {i = i})
        rewrite strip-b {Γ = ⟨ c ⟩ᶜ} {ps = authDecorations (c ‼ i)} {i = 0ᶠ} {j = i}
              = [C-Control]

      strip-→ₜ : Γ      at t —→ₜ[ α ] Γ′      at t′
               → (Γ ∗ᶜ) at t —→ₜ[ α ] (Γ′ ∗ᶜ) at t′
      strip-→ₜ ([Action] Γ→) = [Action] (strip-→ Γ→)
      strip-→ₜ [Delay]       = [Delay]
      strip-→ₜ {t = t} {t′ = t′} ([Timeout] {Γ = Γ} {Γ′ = Γ′} ∀≤t c‼i→)
          = [Timeout] {Γ = Γ ∗ᶜ} {Γ′ = Γ′ ∗ᶜ} ∀≤t (strip-→ c‼i→)

      pr₁ : ∀ T′
        → R   ——→[ α ] T′
          -----------------
        → R ∗ ——→[ α ] T′ ∗ᵗ
      pr₁ T′ R→ rewrite strip-lastCfg {R}
                      = strip-→ₜ R→

      pr0 : ∀ (Γ₀ : Configuration Iᶜᶠ[ ads , cs , ds ])
        → Γ₀ —→[ α ] Γ′
        → Γ₀ ≡ Γ ∗ᶜ
          ---------------------------------
        → ∃[ Γ″ ] ( (Γ —→[ α ] Γ″)
                  × Γ′ ∗ᶜ ≡ Γ″ ∗ᶜ )
      pr0 {Γ′ = Γ′} {Γ = Γ} Γ₀ Γ→ Γ₀≡
        with Γ→
      ... | _ = {!!}
      -- ... | [C-AuthRev] {s = s} {A = A} _
      --     = ⊥-elim (α≢₁ A s refl)
      -- ... | [C-AuthCommit] {A = A} {ci = ci} {pi = pi} {ad = ad} {secrets = secrets} _ _
      --     = ⊥-elim (α≢₂ A (ci , pi , ad) secrets refl)
      -- ... | [C-Withdraw] {v = v} {A = A} {Γ = γ∗}
      --     = let l = ⟨ A , v ⟩ᵈ
      --       in case destruct-γ∗ {Γ = Γ} {Γ₀ = Γ₀} {l = ⟨ [ withdraw A ] ⟩ᶜ} {γ∗ = γ∗}
      --                           {pr = refl &amp; refl &amp; refl &amp; refl &amp; refl &amp; refl}
      --                           Γ₀≡ refl
      --          of λ { (γ , refl , refl) →
      --                    (l ∣∣ γ ∶- refl &amp; refl &amp; refl &amp; refl &amp; refl &amp; refl)
      --                  , [C-Withdraw] {v = v} {A = A} {Γ = γ}
      --                  , strip-strip-rewrite {l = l} {γ = γ} {pr = refl &amp; refl &amp; refl &amp; refl &amp; refl &amp; refl} }
      -- ... | [C-AuthControl] {A = A} {Γ = γ∗} {ci = ci} {contract = c} {i = i} p
      --     = let l = ⟨ c  ⟩ᶜ ∣∣ A auth[ c ▷ᵇ i ]∶- refl &amp; refl &amp; refl &amp; refl &amp; refl &amp; refl
      --                       ∶- refl &amp; refl &amp; refl &amp; SETᶜ.\\-same {[ ci , c ]} &amp; refl &amp; refl
      --           in case destruct-γ∗ {Γ = Γ} {Γ₀ = Γ₀} {l = ⟨ c ⟩ᶜ} {γ∗ = γ∗}
      --                               {pr = refl &amp; refl &amp; refl &amp; refl &amp; refl &amp; refl}
      --                               Γ₀≡ refl
      --              of λ { (γ , refl , refl) →
      --                        (l ∣∣ γ ∶- refl &amp; refl &amp; refl &amp; refl &amp; refl &amp; refl)
      --                      , [C-AuthControl] {A = A} {Γ = γ} {contract = c} {i = i} p
      --                      , strip-strip-rewrite {l = l} {γ = γ} {pr = refl &amp; refl &amp; refl &amp; refl &amp; refl &amp; refl} }

      pr1 : ∀ {Γ₀ : Configuration Iᶜᶠ[ ads , cs , ds ]}
        → Γ₀ at t —→ₜ[ α ] Γ′ at t′
        → Γ₀ ≡ Γ ∗ᶜ
          ------------------------------------
        → ∃[ Γ″ ] ( (Γ at t —→ₜ[ α ] Γ″ at t′)
                  × (Γ′ ∗ᶜ ≡ Γ″ ∗ᶜ) )
      pr1 {Γ′ = Γ′} {Γ = Γ} {Γ₀ = Γ₀} Γ→ₜ Γ₀≡ with Γ→ₜ
      ... | [Action] Γ→
          = case pr0 {Γ′ = Γ′} {Γ = Γ} Γ₀ Γ→ Γ₀≡
            of λ { (Γ″ , Γ→Γ″ , Γ≡) → Γ″ , [Action] Γ→Γ″ , Γ≡ }
      ... | [Delay] {δ = δ} = case Γ₀≡ of λ { refl → Γ , [Delay] {δ = δ} , strip-idempotent Γ }
      ... | [Timeout] {Γ = γ∗} {Γ′ = .Γ′} {contract = c} {i = i} ∀t Γ→
        with destruct-γ∗ {Γ = Γ} {Γ₀ = Γ₀} {l = ⟨ c ⟩ᶜ} {γ∗ = γ∗}
                         {pr = refl &amp; refl &amp; refl &amp; refl &amp; refl &amp; refl}
                         Γ₀≡ refl
      ... | γ , refl , refl
        with pr0 {Γ′ = Γ′}
                 {Γ = ⟨ [ c ‼ i ] ⟩ᶜ ∣∣ γ ∶- refl &amp; refl &amp; refl &amp; refl &amp; refl &amp; refl}
                 (⟨ [ c ‼ i ] ⟩ᶜ ∣∣ γ∗ ∶- refl &amp; refl &amp; refl &amp; refl &amp; refl &amp; refl)
                 Γ→ refl
      ... | Γ″ , Γ→Γ″ , Γ≡
          = Γ″ , [Timeout] {Γ = γ} {Γ′ = Γ″} {contract = c} {i = i} ∀t Γ→Γ″ , Γ≡

      pr₂ : ∀ T′
        → R ∗ ——→[ α ] T′
          --------------------------
        → ∃[ T″ ] ( (R ——→[ α ] T″)
                  × T′ ∗ᵗ ≡ T″ ∗ᵗ )
      pr₂ T′ R→
        with inspect (lastCfg R)
      ... | (cfi , tc) with≡ eq
        with inspect T′
      ... | (cfi′ , tc′) with≡ eq′
        with inspect tc
      ... | (Γ at t) with≡ eqt
        with inspect tc′
      ... | (Γ′ at t′) with≡ eqt′
        with (eq , eq′ , eqt , eqt′)
      ... | refl , refl , refl , refl
        with pr1 {t = t} {Γ′ = Γ′} {t′ = t′} {Γ = Γ} {Γ₀ = Γ ∗ᶜ} (help {R = R} {T′ = T′} R→) refl
      ... | Γ″ , Γ→ , Γ≡ = (cfi′ , Γ″ at t′) , Γ→ , cong (λ g → (cfi′ , g at t′)) Γ≡
-}</a>

<a id="8896" class="Comment">----------------------------------------</a>
<a id="8937" class="Comment">-- Lemma 4</a>

<a id="8949" class="Keyword">module</a> <a id="8956" href="SymbolicModel.Lemmas.html#8956" class="Module">_</a> <a id="8958" class="Symbol">(</a><a id="8959" href="SymbolicModel.Lemmas.html#8959" class="Bound">Adv</a> <a id="8963" class="Symbol">:</a> <a id="8965" href="SymbolicModel.Lemmas.html#1429" class="Bound">Participant</a><a id="8976" class="Symbol">)</a> <a id="8978" class="Symbol">(</a><a id="8979" href="SymbolicModel.Lemmas.html#8979" class="Bound">Adv∉</a> <a id="8984" class="Symbol">:</a> <a id="8986" href="SymbolicModel.Lemmas.html#8959" class="Bound">Adv</a> <a id="8990" href="Data.List.Membership.Setoid.html#931" class="Function Operator">∉</a> <a id="8992" href="BitML.Contracts.Types.html#776" class="Function">Hon</a><a id="8995" class="Symbol">)</a> <a id="8997" class="Keyword">where</a>
  <a id="9005" class="Keyword">open</a> <a id="9010" href="SymbolicModel.Strategy.html#4107" class="Module">SM.AdvM</a> <a id="9018" href="SymbolicModel.Lemmas.html#8959" class="Bound">Adv</a> <a id="9022" href="SymbolicModel.Lemmas.html#8979" class="Bound">Adv∉</a>

  <a id="9030" class="Keyword">variable</a>
    <a id="9043" href="SymbolicModel.Lemmas.html#9043" class="Generalizable">S†</a> <a id="9046" class="Symbol">:</a> <a id="9048" href="SymbolicModel.Strategy.html#4167" class="Record">AdversaryStrategy</a>
    <a id="9070" href="SymbolicModel.Lemmas.html#9070" class="Generalizable">S</a>  <a id="9073" class="Symbol">:</a> <a id="9075" href="SymbolicModel.Strategy.html#3864" class="Function">HonestStrategies</a>

  <a id="9095" href="SymbolicModel.Lemmas.html#9095" class="Function">adversarial-move-is-semantic</a> <a id="9124" class="Symbol">:</a>
    <a id="9130" href="Data.Product.html#1788" class="Function">∃[</a> <a id="9133" href="SymbolicModel.Lemmas.html#9133" class="Bound">T′</a> <a id="9136" href="Data.Product.html#1788" class="Function">]</a> <a id="9138" class="Symbol">(</a> <a id="9140" href="SymbolicModel.Strategy.html#1923" class="Generalizable">R</a> <a id="9142" href="SymbolicModel.Strategy.html#2764" class="Function Operator">——→[</a> <a id="9147" href="SymbolicModel.Strategy.html#6023" class="Function">runAdversary</a> <a id="9160" class="Symbol">(</a><a id="9161" href="SymbolicModel.Lemmas.html#9043" class="Generalizable">S†</a> <a id="9164" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="9166" href="SymbolicModel.Lemmas.html#9070" class="Generalizable">S</a><a id="9167" class="Symbol">)</a> <a id="9169" href="SymbolicModel.Strategy.html#1923" class="Generalizable">R</a> <a id="9171" href="SymbolicModel.Strategy.html#2764" class="Function Operator">]</a> <a id="9173" href="SymbolicModel.Lemmas.html#9133" class="Bound">T′</a><a id="9175" class="Symbol">)</a>
  <a id="9179" href="SymbolicModel.Lemmas.html#9095" class="Function">adversarial-move-is-semantic</a> <a id="9208" class="Symbol">=</a> <a id="9210" class="Symbol">{!!}</a>

<a id="9216" class="Comment">{-
  valid-hon-move : ∀ {A} (A∈ : A ∈ Hon)
    → runAdversary (S† , S) R ∈ concatMap proj₂ (runHonestAll (R ∗) S)
    → runAdversary (S† , S) R ∈ strategy (S A∈) (R ∗)
  valid-hon-move = {!!}

  adversarial-move-is-semantic {R = R} {S† = S†} {S = S} =
    let
      moves = runHonestAll (R ∗) S
      (cases , v) = valid S† {R = R} {moves = moves}
    in case cases of
    λ { (inj₁ (A , A∈ , eq , α∈ ))
      → let (_ , R→ , _) = valid (S A∈)
        in R→ {R} {runAdversary (S† , S) R} (valid-hon-move {S† = S†} {S = S} {R = R} {A = A} A∈ α∈)
      ; c → {!!}
      }


-- T0D0 induction on list of honest strategies
-- T0D0 induction on the run itself
-}</a>
</pre></body></html>