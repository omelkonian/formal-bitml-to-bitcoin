<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Bitcoin.Tx.Base</title><link rel="stylesheet" href="css/Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- Transactions.</a>
<a id="91" class="Comment">------------------------------------------------------------------------</a>
<a id="164" class="Keyword">module</a> <a id="171" href="Bitcoin.Tx.Base.html" class="Module">Bitcoin.Tx.Base</a> <a id="187" class="Keyword">where</a>

<a id="194" class="Keyword">open</a> <a id="199" class="Keyword">import</a> <a id="206" href="Data.Nat.html" class="Module">Data.Nat</a>     <a id="219" class="Keyword">using</a> <a id="225" class="Symbol">(</a><a id="226" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a><a id="227" class="Symbol">)</a>
<a id="229" class="Keyword">open</a> <a id="234" class="Keyword">import</a> <a id="241" href="Data.Product.html" class="Module">Data.Product</a> <a id="254" class="Keyword">using</a> <a id="260" class="Symbol">(</a><a id="261" href="Data.Product.html#1788" class="Function">∃-syntax</a><a id="269" class="Symbol">)</a>
<a id="271" class="Keyword">open</a> <a id="276" class="Keyword">import</a> <a id="283" href="Data.Fin.html" class="Module">Data.Fin</a>     <a id="296" class="Keyword">using</a> <a id="302" class="Symbol">(</a><a id="303" href="Data.Fin.Base.html#1066" class="Datatype">Fin</a><a id="306" class="Symbol">)</a>
<a id="308" class="Keyword">open</a> <a id="313" class="Keyword">import</a> <a id="320" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="333" class="Keyword">using</a> <a id="339" class="Symbol">(</a><a id="340" href="Agda.Builtin.Int.html#246" class="Datatype">ℤ</a><a id="341" class="Symbol">)</a>
<a id="343" class="Keyword">open</a> <a id="348" class="Keyword">import</a> <a id="355" href="Data.Vec.html" class="Module">Data.Vec</a>     <a id="368" class="Keyword">using</a> <a id="374" class="Symbol">(</a><a id="375" href="Data.Vec.Base.html#959" class="Datatype">Vec</a><a id="378" class="Symbol">;</a> <a id="380" href="Data.Vec.Base.html#1566" class="Function">lookup</a><a id="386" class="Symbol">)</a>

<a id="389" class="Keyword">open</a> <a id="394" class="Keyword">import</a> <a id="401" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="439" class="Keyword">using</a> <a id="445" class="Symbol">(</a><a id="446" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">_≡_</a><a id="449" class="Symbol">)</a>

<a id="452" class="Keyword">open</a> <a id="457" class="Keyword">import</a> <a id="464" href="Bitcoin.BasicTypes.html" class="Module">Bitcoin.BasicTypes</a>
<a id="483" class="Keyword">open</a> <a id="488" class="Keyword">import</a> <a id="495" href="Bitcoin.Script.Base.html" class="Module">Bitcoin.Script.Base</a>

<a id="516" class="Keyword">record</a> <a id="TxInput"></a><a id="523" href="Bitcoin.Tx.Base.html#523" class="Record">TxInput</a> <a id="531" class="Symbol">:</a> <a id="533" class="PrimitiveType">Set</a> <a id="537" class="Keyword">where</a>
  <a id="545" class="Keyword">constructor</a> <a id="_at_"></a><a id="557" href="Bitcoin.Tx.Base.html#557" class="InductiveConstructor Operator">_at_</a>
  <a id="564" class="Keyword">field</a>
    <a id="TxInput.txId"></a><a id="574" href="Bitcoin.Tx.Base.html#574" class="Field">txId</a>  <a id="580" class="Symbol">:</a> <a id="582" href="Bitcoin.BasicTypes.html#330" class="Function">HashId</a>  <a id="590" class="Comment">-- referenced previous transaction</a>
    <a id="TxInput.index"></a><a id="629" href="Bitcoin.Tx.Base.html#629" class="Field">index</a> <a id="635" class="Symbol">:</a> <a id="637" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>       <a id="645" class="Comment">-- index in the referenced transaction&#39;s outputs</a>
<a id="694" class="Keyword">open</a> <a id="699" href="Bitcoin.Tx.Base.html#523" class="Module">TxInput</a> <a id="707" class="Keyword">public</a>

<a id="715" class="Keyword">record</a> <a id="TxOutput"></a><a id="722" href="Bitcoin.Tx.Base.html#722" class="Record">TxOutput</a> <a id="731" class="Symbol">(</a><a id="732" href="Bitcoin.Tx.Base.html#732" class="Bound">ctx</a> <a id="736" class="Symbol">:</a> <a id="738" href="Bitcoin.Script.Base.html#766" class="Datatype">ScriptContext</a><a id="751" class="Symbol">)</a> <a id="753" class="Symbol">:</a> <a id="755" class="PrimitiveType">Set</a> <a id="759" class="Keyword">where</a>
  <a id="767" class="Keyword">field</a>
    <a id="TxOutput.value"></a><a id="777" href="Bitcoin.Tx.Base.html#777" class="Field">value</a>     <a id="787" class="Symbol">:</a> <a id="789" href="Bitcoin.BasicTypes.html#267" class="Function">Value</a>
    <a id="TxOutput.validator"></a><a id="799" href="Bitcoin.Tx.Base.html#799" class="Field">validator</a> <a id="809" class="Symbol">:</a> <a id="811" href="Bitcoin.Script.Base.html#2323" class="Datatype">BitcoinScript</a> <a id="825" href="Bitcoin.Tx.Base.html#732" class="Bound">ctx</a>
<a id="829" class="Keyword">open</a> <a id="834" href="Bitcoin.Tx.Base.html#722" class="Module">TxOutput</a> <a id="843" class="Keyword">public</a>
<a id="∃TxOutput"></a><a id="850" href="Bitcoin.Tx.Base.html#850" class="Function">∃TxOutput</a> <a id="860" class="Symbol">=</a> <a id="862" href="Data.Product.html#1788" class="Function">∃[</a> <a id="865" href="Bitcoin.Tx.Base.html#865" class="Bound">ctx</a> <a id="869" href="Data.Product.html#1788" class="Function">]</a> <a id="871" href="Bitcoin.Tx.Base.html#722" class="Record">TxOutput</a> <a id="880" href="Bitcoin.Tx.Base.html#865" class="Bound">ctx</a>

<a id="Witness"></a><a id="885" href="Bitcoin.Tx.Base.html#885" class="Function">Witness</a> <a id="893" class="Symbol">:</a> <a id="895" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="897" class="Symbol">→</a> <a id="899" class="PrimitiveType">Set</a>
<a id="903" href="Bitcoin.Tx.Base.html#885" class="Function">Witness</a> <a id="911" href="Bitcoin.Tx.Base.html#911" class="Bound">n</a> <a id="913" class="Symbol">=</a> <a id="915" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="919" href="Agda.Builtin.Int.html#246" class="Datatype">ℤ</a> <a id="921" href="Bitcoin.Tx.Base.html#911" class="Bound">n</a>

<a id="∃Witness"></a><a id="924" href="Bitcoin.Tx.Base.html#924" class="Function">∃Witness</a> <a id="933" class="Symbol">=</a> <a id="935" href="Data.Product.html#1788" class="Function">∃[</a> <a id="938" href="Bitcoin.Tx.Base.html#938" class="Bound">n</a> <a id="940" href="Data.Product.html#1788" class="Function">]</a> <a id="942" href="Bitcoin.Tx.Base.html#885" class="Function">Witness</a> <a id="950" href="Bitcoin.Tx.Base.html#938" class="Bound">n</a>

<a id="953" class="Keyword">record</a> <a id="Tx"></a><a id="960" href="Bitcoin.Tx.Base.html#960" class="Record">Tx</a> <a id="963" class="Symbol">(</a><a id="964" href="Bitcoin.Tx.Base.html#964" class="Bound">i</a> <a id="966" href="Bitcoin.Tx.Base.html#966" class="Bound">o</a> <a id="968" class="Symbol">:</a> <a id="970" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a><a id="971" class="Symbol">)</a> <a id="973" class="Symbol">:</a> <a id="975" class="PrimitiveType">Set</a> <a id="979" class="Keyword">where</a>
  <a id="987" class="Keyword">field</a>
    <a id="Tx.inputs"></a><a id="997" href="Bitcoin.Tx.Base.html#997" class="Field">inputs</a>  <a id="1005" class="Symbol">:</a> <a id="1007" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1011" href="Bitcoin.Tx.Base.html#523" class="Record">TxInput</a>  <a id="1020" href="Bitcoin.Tx.Base.html#964" class="Bound">i</a>   <a id="1024" class="Comment">-- inputs</a>
    <a id="Tx.wit"></a><a id="1038" href="Bitcoin.Tx.Base.html#1038" class="Field">wit</a>     <a id="1046" class="Symbol">:</a> <a id="1048" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1052" href="Bitcoin.Tx.Base.html#924" class="Function">∃Witness</a> <a id="1061" href="Bitcoin.Tx.Base.html#964" class="Bound">i</a>   <a id="1065" class="Comment">-- segragated witnesses</a>
    <a id="Tx.relLock"></a><a id="1093" href="Bitcoin.Tx.Base.html#1093" class="Field">relLock</a> <a id="1101" class="Symbol">:</a> <a id="1103" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1107" href="Bitcoin.BasicTypes.html#309" class="Function">Time</a>     <a id="1116" href="Bitcoin.Tx.Base.html#964" class="Bound">i</a>   <a id="1120" class="Comment">-- relative timelocks</a>

    <a id="Tx.outputs"></a><a id="1147" href="Bitcoin.Tx.Base.html#1147" class="Field">outputs</a> <a id="1155" class="Symbol">:</a> <a id="1157" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1161" href="Bitcoin.Tx.Base.html#850" class="Function">∃TxOutput</a> <a id="1171" href="Bitcoin.Tx.Base.html#966" class="Bound">o</a>  <a id="1174" class="Comment">-- outputs</a>
    <a id="Tx.absLock"></a><a id="1189" href="Bitcoin.Tx.Base.html#1189" class="Field">absLock</a> <a id="1197" class="Symbol">:</a> <a id="1199" href="Bitcoin.BasicTypes.html#309" class="Function">Time</a>             <a id="1216" class="Comment">-- absolute timelock</a>
<a id="1237" class="Keyword">open</a> <a id="1242" href="Bitcoin.Tx.Base.html#960" class="Module">Tx</a> <a id="1245" class="Keyword">public</a>
<a id="∃Tx"></a><a id="1252" href="Bitcoin.Tx.Base.html#1252" class="Function">∃Tx</a> <a id="1256" class="Symbol">=</a> <a id="1258" href="Data.Product.html#1788" class="Function">∃[</a> <a id="1261" href="Bitcoin.Tx.Base.html#1261" class="Bound">i</a> <a id="1263" href="Data.Product.html#1788" class="Function">]</a> <a id="1265" href="Data.Product.html#1788" class="Function">∃[</a> <a id="1268" href="Bitcoin.Tx.Base.html#1268" class="Bound">o</a> <a id="1270" href="Data.Product.html#1788" class="Function">]</a> <a id="1272" href="Bitcoin.Tx.Base.html#960" class="Record">Tx</a> <a id="1275" href="Bitcoin.Tx.Base.html#1261" class="Bound">i</a> <a id="1277" href="Bitcoin.Tx.Base.html#1268" class="Bound">o</a>

<a id="1280" class="Keyword">variable</a>
  <a id="1291" href="Bitcoin.Tx.Base.html#1291" class="Generalizable">i</a> <a id="1293" href="Bitcoin.Tx.Base.html#1293" class="Generalizable">i′</a> <a id="1296" href="Bitcoin.Tx.Base.html#1296" class="Generalizable">o</a> <a id="1298" href="Bitcoin.Tx.Base.html#1298" class="Generalizable">o′</a> <a id="1301" class="Symbol">:</a> <a id="1303" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>

<a id="_‼ⁱ_"></a><a id="1306" href="Bitcoin.Tx.Base.html#1306" class="Function Operator">_‼ⁱ_</a> <a id="1311" class="Symbol">:</a> <a id="1313" href="Bitcoin.Tx.Base.html#960" class="Record">Tx</a> <a id="1316" href="Bitcoin.Tx.Base.html#1291" class="Generalizable">i</a> <a id="1318" href="Bitcoin.Tx.Base.html#1296" class="Generalizable">o</a> <a id="1320" class="Symbol">→</a> <a id="1322" href="Data.Fin.Base.html#1066" class="Datatype">Fin</a> <a id="1326" href="Bitcoin.Tx.Base.html#1291" class="Generalizable">i</a> <a id="1328" class="Symbol">→</a> <a id="1330" href="Bitcoin.Tx.Base.html#523" class="Record">TxInput</a>
<a id="1338" href="Bitcoin.Tx.Base.html#1338" class="Bound">tx</a> <a id="1341" href="Bitcoin.Tx.Base.html#1306" class="Function Operator">‼ⁱ</a> <a id="1344" href="Bitcoin.Tx.Base.html#1344" class="Bound">i</a> <a id="1346" class="Symbol">=</a> <a id="1348" href="Data.Vec.Base.html#1566" class="Function">lookup</a> <a id="1355" class="Symbol">(</a><a id="1356" href="Bitcoin.Tx.Base.html#997" class="Field">inputs</a> <a id="1363" href="Bitcoin.Tx.Base.html#1338" class="Bound">tx</a><a id="1365" class="Symbol">)</a> <a id="1367" href="Bitcoin.Tx.Base.html#1344" class="Bound">i</a>

<a id="_‼ʷ_"></a><a id="1370" href="Bitcoin.Tx.Base.html#1370" class="Function Operator">_‼ʷ_</a> <a id="1375" class="Symbol">:</a> <a id="1377" href="Bitcoin.Tx.Base.html#960" class="Record">Tx</a> <a id="1380" href="Bitcoin.Tx.Base.html#1291" class="Generalizable">i</a> <a id="1382" href="Bitcoin.Tx.Base.html#1296" class="Generalizable">o</a> <a id="1384" class="Symbol">→</a> <a id="1386" href="Data.Fin.Base.html#1066" class="Datatype">Fin</a> <a id="1390" href="Bitcoin.Tx.Base.html#1291" class="Generalizable">i</a> <a id="1392" class="Symbol">→</a> <a id="1394" href="Bitcoin.Tx.Base.html#924" class="Function">∃Witness</a>
<a id="1403" href="Bitcoin.Tx.Base.html#1403" class="Bound">tx</a> <a id="1406" href="Bitcoin.Tx.Base.html#1370" class="Function Operator">‼ʷ</a> <a id="1409" href="Bitcoin.Tx.Base.html#1409" class="Bound">i</a> <a id="1411" class="Symbol">=</a> <a id="1413" href="Data.Vec.Base.html#1566" class="Function">lookup</a> <a id="1420" class="Symbol">(</a><a id="1421" href="Bitcoin.Tx.Base.html#1038" class="Field">wit</a> <a id="1425" href="Bitcoin.Tx.Base.html#1403" class="Bound">tx</a><a id="1427" class="Symbol">)</a> <a id="1429" href="Bitcoin.Tx.Base.html#1409" class="Bound">i</a>

<a id="_‼ʳ_"></a><a id="1432" href="Bitcoin.Tx.Base.html#1432" class="Function Operator">_‼ʳ_</a> <a id="1437" class="Symbol">:</a> <a id="1439" href="Bitcoin.Tx.Base.html#960" class="Record">Tx</a> <a id="1442" href="Bitcoin.Tx.Base.html#1291" class="Generalizable">i</a> <a id="1444" href="Bitcoin.Tx.Base.html#1296" class="Generalizable">o</a> <a id="1446" class="Symbol">→</a> <a id="1448" href="Data.Fin.Base.html#1066" class="Datatype">Fin</a> <a id="1452" href="Bitcoin.Tx.Base.html#1291" class="Generalizable">i</a> <a id="1454" class="Symbol">→</a> <a id="1456" href="Bitcoin.BasicTypes.html#309" class="Function">Time</a>
<a id="1461" href="Bitcoin.Tx.Base.html#1461" class="Bound">tx</a> <a id="1464" href="Bitcoin.Tx.Base.html#1432" class="Function Operator">‼ʳ</a> <a id="1467" href="Bitcoin.Tx.Base.html#1467" class="Bound">i</a> <a id="1469" class="Symbol">=</a> <a id="1471" href="Data.Vec.Base.html#1566" class="Function">lookup</a> <a id="1478" class="Symbol">(</a><a id="1479" href="Bitcoin.Tx.Base.html#1093" class="Field">relLock</a> <a id="1487" href="Bitcoin.Tx.Base.html#1461" class="Bound">tx</a><a id="1489" class="Symbol">)</a> <a id="1491" href="Bitcoin.Tx.Base.html#1467" class="Bound">i</a>

<a id="_‼ᵒ_"></a><a id="1494" href="Bitcoin.Tx.Base.html#1494" class="Function Operator">_‼ᵒ_</a> <a id="1499" class="Symbol">:</a> <a id="1501" href="Bitcoin.Tx.Base.html#960" class="Record">Tx</a> <a id="1504" href="Bitcoin.Tx.Base.html#1291" class="Generalizable">i</a> <a id="1506" href="Bitcoin.Tx.Base.html#1296" class="Generalizable">o</a> <a id="1508" class="Symbol">→</a> <a id="1510" href="Data.Fin.Base.html#1066" class="Datatype">Fin</a> <a id="1514" href="Bitcoin.Tx.Base.html#1296" class="Generalizable">o</a> <a id="1516" class="Symbol">→</a> <a id="1518" href="Bitcoin.Tx.Base.html#850" class="Function">∃TxOutput</a>
<a id="1528" href="Bitcoin.Tx.Base.html#1528" class="Bound">tx</a> <a id="1531" href="Bitcoin.Tx.Base.html#1494" class="Function Operator">‼ᵒ</a> <a id="1534" href="Bitcoin.Tx.Base.html#1534" class="Bound">i</a> <a id="1536" class="Symbol">=</a> <a id="1538" href="Data.Vec.Base.html#1566" class="Function">lookup</a> <a id="1545" class="Symbol">(</a><a id="1546" href="Bitcoin.Tx.Base.html#1147" class="Field">outputs</a> <a id="1554" href="Bitcoin.Tx.Base.html#1528" class="Bound">tx</a><a id="1556" class="Symbol">)</a> <a id="1558" href="Bitcoin.Tx.Base.html#1534" class="Bound">i</a>

<a id="1561" class="Comment">-- Coinbase transactions start at time t=0.</a>
<a id="Coinbase"></a><a id="1605" href="Bitcoin.Tx.Base.html#1605" class="Function">Coinbase</a> <a id="1614" class="Symbol">:</a> <a id="1616" href="Bitcoin.Tx.Base.html#960" class="Record">Tx</a> <a id="1619" class="Number">0</a> <a id="1621" href="Bitcoin.Tx.Base.html#1296" class="Generalizable">o</a> <a id="1623" class="Symbol">→</a> <a id="1625" class="PrimitiveType">Set</a>
<a id="1629" href="Bitcoin.Tx.Base.html#1605" class="Function">Coinbase</a> <a id="1638" href="Bitcoin.Tx.Base.html#1638" class="Bound">tx</a> <a id="1641" class="Symbol">=</a> <a id="1643" href="Bitcoin.Tx.Base.html#1189" class="Field">absLock</a> <a id="1651" href="Bitcoin.Tx.Base.html#1638" class="Bound">tx</a> <a id="1654" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="1656" class="Number">0</a>

<a id="1659" class="Comment">-- Timed transactions.</a>
<a id="1682" class="Keyword">record</a> <a id="TimedTx"></a><a id="1689" href="Bitcoin.Tx.Base.html#1689" class="Record">TimedTx</a> <a id="1697" class="Symbol">:</a> <a id="1699" class="PrimitiveType">Set</a> <a id="1703" class="Keyword">where</a>
  <a id="1711" class="Keyword">constructor</a> <a id="_at_"></a><a id="1723" href="Bitcoin.Tx.Base.html#1723" class="InductiveConstructor Operator">_at_</a>
  <a id="1730" class="Keyword">field</a>
    <a id="TimedTx.transaction"></a><a id="1740" href="Bitcoin.Tx.Base.html#1740" class="Field">transaction</a> <a id="1752" class="Symbol">:</a> <a id="1754" href="Bitcoin.Tx.Base.html#1252" class="Function">∃Tx</a>
    <a id="TimedTx.time"></a><a id="1762" href="Bitcoin.Tx.Base.html#1762" class="Field">time</a>        <a id="1774" class="Symbol">:</a> <a id="1776" href="Bitcoin.BasicTypes.html#309" class="Function">Time</a>
<a id="1781" class="Keyword">open</a> <a id="1786" href="Bitcoin.Tx.Base.html#1689" class="Module">TimedTx</a> <a id="1794" class="Keyword">public</a>
</pre></body></html>