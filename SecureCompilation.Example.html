<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>SecureCompilation.Example</title><link rel="stylesheet" href="css/Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">----------------------------------------------------------------------------</a>
<a id="78" class="Comment">-- Example contract compilations.</a>
<a id="112" class="Comment">----------------------------------------------------------------------------</a>
<a id="189" class="Keyword">module</a> <a id="196" href="SecureCompilation.Example.html" class="Module">SecureCompilation.Example</a> <a id="222" class="Keyword">where</a>

<a id="229" class="Keyword">open</a> <a id="234" class="Keyword">import</a> <a id="241" href="Prelude.Init.html" class="Module">Prelude.Init</a>
<a id="254" class="Keyword">open</a> <a id="259" class="Keyword">import</a> <a id="266" href="Prelude.Applicative.html" class="Module">Prelude.Applicative</a>
<a id="286" class="Keyword">open</a> <a id="291" class="Keyword">import</a> <a id="298" href="Prelude.Semigroup.html" class="Module">Prelude.Semigroup</a>
<a id="316" class="Keyword">open</a> <a id="321" class="Keyword">import</a> <a id="328" href="Prelude.Nary.html" class="Module">Prelude.Nary</a>
<a id="341" class="Keyword">open</a> <a id="346" class="Keyword">import</a> <a id="353" href="Prelude.Lists.html" class="Module">Prelude.Lists</a>

<a id="368" class="Comment">-- Bitcoin</a>
<a id="379" class="Keyword">open</a> <a id="384" class="Keyword">import</a> <a id="391" href="Bitcoin.Crypto.html" class="Module">Bitcoin.Crypto</a> <a id="406" class="Keyword">using</a> <a id="412" class="Symbol">(</a><a id="413" href="Bitcoin.Crypto.html#321" class="Record">KeyPair</a><a id="420" class="Symbol">;</a> <a id="422" href="Bitcoin.Crypto.html#526" class="Postulate">HASH</a><a id="426" class="Symbol">)</a>
<a id="428" class="Keyword">open</a> <a id="433" class="Keyword">import</a> <a id="440" href="Bitcoin.Script.Base.html" class="Module">Bitcoin.Script.Base</a>
<a id="460" class="Keyword">open</a> <a id="465" class="Keyword">import</a> <a id="472" href="Bitcoin.Tx.Base.html" class="Module">Bitcoin.Tx.Base</a>
<a id="488" class="Keyword">open</a> <a id="493" class="Keyword">import</a> <a id="500" href="Bitcoin.Tx.Crypto.html" class="Module">Bitcoin.Tx.Crypto</a> <a id="518" class="Keyword">using</a> <a id="524" class="Symbol">(</a><a id="525" href="Bitcoin.Tx.Crypto.html#1043" class="Function">sig⋆</a><a id="529" class="Symbol">;</a> <a id="531" href="Bitcoin.Tx.Crypto.html#720" class="Function">hashTx</a><a id="537" class="Symbol">;</a> <a id="539" href="Bitcoin.Tx.Crypto.html#552" class="Function">wit⊥</a><a id="543" class="Symbol">)</a>

<a id="546" class="Comment">-- BitML</a>
<a id="555" class="Keyword">open</a> <a id="560" class="Keyword">import</a> <a id="567" href="BitML.Example.Setup.html" class="Module">BitML.Example.Setup</a>       <a id="593" class="Keyword">using</a> <a id="599" class="Symbol">(</a><a id="600" href="BitML.Example.Setup.html#208" class="Datatype">Participant</a><a id="611" class="Symbol">;</a> <a id="613" href="BitML.Example.Setup.html#318" class="Function">Honest</a><a id="619" class="Symbol">;</a> <a id="621" href="BitML.Example.Setup.html#234" class="InductiveConstructor">A</a><a id="622" class="Symbol">;</a> <a id="624" href="BitML.Example.Setup.html#236" class="InductiveConstructor">B</a><a id="625" class="Symbol">)</a>
<a id="627" class="Keyword">open</a> <a id="632" class="Keyword">import</a> <a id="639" href="BitML.BasicTypes.html" class="Module">BitML.BasicTypes</a>          <a id="665" class="Keyword">hiding</a> <a id="672" class="Symbol">(</a><a id="673" href="BitML.BasicTypes.html#520" class="Generalizable">t</a><a id="674" class="Symbol">;</a> <a id="676" href="BitML.BasicTypes.html#446" class="Generalizable">a</a><a id="677" class="Symbol">;</a> <a id="679" href="BitML.BasicTypes.html#412" class="Generalizable">v</a><a id="680" class="Symbol">)</a>
<a id="682" class="Keyword">open</a> <a id="687" class="Keyword">import</a> <a id="694" href="BitML.Contracts.Types.html" class="Module">BitML.Contracts.Types</a>     <a id="720" href="BitML.Example.Setup.html#208" class="Datatype">Participant</a> <a id="732" href="BitML.Example.Setup.html#318" class="Function">Honest</a> <a id="739" class="Keyword">hiding</a> <a id="746" class="Symbol">(</a>A<a id="748" class="Symbol">;</a> B<a id="751" class="Symbol">)</a>
<a id="753" class="Keyword">open</a> <a id="758" class="Keyword">import</a> <a id="765" href="BitML.Contracts.Induction.html" class="Module">BitML.Contracts.Induction</a> <a id="791" href="BitML.Example.Setup.html#208" class="Datatype">Participant</a> <a id="803" href="BitML.Example.Setup.html#318" class="Function">Honest</a> <a id="810" class="Keyword">using</a> <a id="816" class="Symbol">(</a>CS<a id="819" class="Symbol">)</a>
<a id="821" class="Keyword">open</a> <a id="826" class="Keyword">import</a> <a id="833" href="BitML.Contracts.Helpers.html" class="Module">BitML.Contracts.Helpers</a>   <a id="859" href="BitML.Example.Setup.html#208" class="Datatype">Participant</a> <a id="871" href="BitML.Example.Setup.html#318" class="Function">Honest</a>
<a id="878" class="Keyword">open</a> <a id="883" class="Keyword">import</a> <a id="890" href="BitML.Contracts.Validity.html" class="Module">BitML.Contracts.Validity</a>  <a id="916" href="BitML.Example.Setup.html#208" class="Datatype">Participant</a> <a id="928" href="BitML.Example.Setup.html#318" class="Function">Honest</a> <a id="935" class="Keyword">using</a> <a id="941" class="Symbol">(</a>ValidAdvertisement<a id="960" class="Symbol">;</a> validAd?<a id="970" class="Symbol">)</a>

<a id="973" class="Comment">-- BitML compiler</a>
<a id="η"></a><a id="991" href="SecureCompilation.Example.html#991" class="Function">η</a> <a id="993" class="Symbol">=</a> <a id="995" class="Number">1</a>
<a id="997" class="Keyword">open</a> <a id="1002" class="Keyword">import</a> <a id="1009" href="SecureCompilation.Compiler.html" class="Module">SecureCompilation.Compiler</a> <a id="1036" href="BitML.Example.Setup.html#208" class="Datatype">Participant</a> <a id="1048" href="BitML.Example.Setup.html#318" class="Function">Honest</a> <a id="1055" href="SecureCompilation.Example.html#991" class="Function">η</a>

<a id="1058" class="Keyword">module</a> <a id="Section7"></a><a id="1065" href="SecureCompilation.Example.html#1065" class="Module">Section7</a> <a id="1074" class="Keyword">where</a> <a id="1080" class="Comment">-- (see BitML paper, Section 7).</a>

  <a id="Section7.ex-ad"></a><a id="1116" href="SecureCompilation.Example.html#1116" class="Function">ex-ad</a> <a id="1122" class="Symbol">:</a> <a id="1124" href="BitML.Contracts.Types.html#2308" class="Record">Advertisement</a>
  <a id="1140" href="SecureCompilation.Example.html#1116" class="Function">ex-ad</a> <a id="1146" class="Symbol">=</a> <a id="1148" href="BitML.Contracts.Types.html#2348" class="InductiveConstructor Operator">⟨</a> <a id="1150" href="BitML.Example.Setup.html#234" class="InductiveConstructor">A</a> <a id="1152" href="BitML.Contracts.Types.html#1859" class="InductiveConstructor Operator">:!</a> <a id="1155" class="Number">1</a> <a id="1157" href="BitML.Contracts.Types.html#1859" class="InductiveConstructor Operator">at</a> <a id="1160" class="String">&quot;x&quot;</a> <a id="1164" href="BitML.Contracts.Types.html#2034" class="InductiveConstructor Operator">∣∣</a> <a id="1167" href="BitML.Example.Setup.html#236" class="InductiveConstructor">B</a> <a id="1169" href="BitML.Contracts.Types.html#1859" class="InductiveConstructor Operator">:!</a> <a id="1172" class="Number">1</a> <a id="1174" href="BitML.Contracts.Types.html#1859" class="InductiveConstructor Operator">at</a> <a id="1177" class="String">&quot;y&quot;</a> <a id="1181" href="BitML.Contracts.Types.html#2348" class="InductiveConstructor Operator">⟩</a> <a id="1183" href="BitML.Contracts.Types.html#886" class="InductiveConstructor">withdraw</a> <a id="1192" href="BitML.Example.Setup.html#236" class="InductiveConstructor">B</a> <a id="1194" href="BitML.Contracts.Types.html#1361" class="Function Operator">∙</a>

  <a id="Section7.partG"></a><a id="1199" href="SecureCompilation.Example.html#1199" class="Function">partG</a> <a id="1205" class="Symbol">=</a> <a id="1207" href="BitML.Contracts.Helpers.html#2456" class="Function">nub-participants</a> <a id="1224" class="Symbol">(</a><a id="1225" href="SecureCompilation.Example.html#1116" class="Function">ex-ad</a> <a id="1231" class="Symbol">.</a><a id="1232" href="BitML.Contracts.Types.html#2365" class="Field">G</a><a id="1233" class="Symbol">)</a>

  <a id="1238" class="Keyword">postulate</a>
    <a id="Section7.Tˣ"></a><a id="1252" href="SecureCompilation.Example.html#1252" class="Postulate">Tˣ</a> <a id="Section7.Tʸ"></a><a id="1255" href="SecureCompilation.Example.html#1255" class="Postulate">Tʸ</a> <a id="1258" class="Symbol">:</a> <a id="1260" href="Bitcoin.Tx.Base.html#343" class="Record">TxInput</a> <a id="1268" class="Comment">-- pre-existing deposits</a>

  <a id="Section7.valid"></a><a id="1296" href="SecureCompilation.Example.html#1296" class="Function">valid</a> <a id="1302" class="Symbol">:</a> <a id="1304" href="BitML.Contracts.Validity.html#885" class="Function">ValidAdvertisement</a> <a id="1323" href="SecureCompilation.Example.html#1116" class="Function">ex-ad</a>
  <a id="1331" href="SecureCompilation.Example.html#1296" class="Function">valid</a> <a id="1337" class="Symbol">=</a> <a id="1339" href="Relation.Nullary.Decidable.Core.html#1484" class="Function">toWitness</a> <a id="1349" class="Symbol">{</a><a id="1350" class="Argument">Q</a> <a id="1352" class="Symbol">=</a> <a id="1354" href="BitML.Contracts.Validity.html#1401" class="Function">validAd?</a> <a id="1363" href="SecureCompilation.Example.html#1116" class="Function">ex-ad</a><a id="1368" class="Symbol">}</a> <a id="1370" href="Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a>

  <a id="Section7.sechash"></a><a id="1376" href="SecureCompilation.Example.html#1376" class="Function">sechash</a> <a id="1384" class="Symbol">:</a> <a id="1386" href="BitML.Contracts.Helpers.html#3539" class="Function">namesˡ</a> <a id="1393" class="Symbol">(</a><a id="1394" href="SecureCompilation.Example.html#1116" class="Function">ex-ad</a> <a id="1400" class="Symbol">.</a><a id="1401" href="BitML.Contracts.Types.html#2365" class="Field">G</a><a id="1402" class="Symbol">)</a> <a id="1404" href="Prelude.Lists.html#10340" class="Function Operator">↦</a> <a id="1406" href="Agda.Builtin.Int.html#246" class="Datatype">ℤ</a>
  <a id="1410" href="SecureCompilation.Example.html#1376" class="Function">sechash</a> <a id="1418" class="Symbol">()</a>

  <a id="Section7.txout"></a><a id="1424" href="SecureCompilation.Example.html#1424" class="Function">txout</a> <a id="1430" class="Symbol">:</a> <a id="1432" href="BitML.Contracts.Helpers.html#3608" class="Function">namesʳ</a> <a id="1439" class="Symbol">(</a><a id="1440" href="SecureCompilation.Example.html#1116" class="Function">ex-ad</a> <a id="1446" class="Symbol">.</a><a id="1447" href="BitML.Contracts.Types.html#2365" class="Field">G</a><a id="1448" class="Symbol">)</a> <a id="1450" href="Prelude.Lists.html#10340" class="Function Operator">↦</a> <a id="1452" href="Bitcoin.Tx.Base.html#343" class="Record">TxInput</a>
  <a id="1462" href="SecureCompilation.Example.html#1424" class="Function">txout</a> <a id="1468" class="Symbol">=</a> <a id="1470" href="Function.Base.html#3544" class="Function Operator">case_of</a> <a id="1478" class="Symbol">λ</a> <a id="1480" class="Keyword">where</a>
    <a id="1490" class="Comment">{- &quot;x&quot; -}</a> <a id="1500" class="Symbol">(</a><a id="1501" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="1506" class="Symbol">_)</a>         <a id="1517" class="Symbol">→</a> <a id="1519" href="SecureCompilation.Example.html#1252" class="Postulate">Tˣ</a>
    <a id="1526" class="Comment">{- &quot;y&quot; -}</a> <a id="1536" class="Symbol">(</a><a id="1537" href="Data.List.Relation.Unary.Any.html#1227" class="InductiveConstructor">there</a> <a id="1543" class="Symbol">(</a><a id="1544" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="1549" class="Symbol">_))</a> <a id="1553" class="Symbol">→</a> <a id="1555" href="SecureCompilation.Example.html#1255" class="Postulate">Tʸ</a>

  <a id="1561" class="Keyword">postulate</a>
    <a id="Section7.Kᵃ"></a><a id="1575" href="SecureCompilation.Example.html#1575" class="Postulate">Kᵃ</a> <a id="Section7.Kᵇ"></a><a id="1578" href="SecureCompilation.Example.html#1578" class="Postulate">Kᵇ</a> <a id="1581" class="Symbol">:</a> <a id="1583" href="Bitcoin.Crypto.html#321" class="Record">KeyPair</a>
    <a id="Section7.Kʷᵇ"></a><a id="1595" href="SecureCompilation.Example.html#1595" class="Postulate">Kʷᵇ</a> <a id="1599" class="Symbol">:</a> <a id="1601" href="BitML.Example.Setup.html#208" class="Datatype">Participant</a> <a id="1613" class="Symbol">→</a> <a id="1615" href="Bitcoin.Crypto.html#321" class="Record">KeyPair</a>

  <a id="Section7.K"></a><a id="1626" href="SecureCompilation.Example.html#1626" class="Function">K</a> <a id="1628" class="Symbol">:</a> <a id="1630" href="SecureCompilation.Example.html#1199" class="Function">partG</a> <a id="1636" href="Prelude.Lists.html#10340" class="Function Operator">↦</a> <a id="1638" href="Bitcoin.Crypto.html#321" class="Record">KeyPair</a>
  <a id="1648" href="SecureCompilation.Example.html#1626" class="Function">K</a> <a id="1650" class="Symbol">=</a> <a id="1652" href="Function.Base.html#3544" class="Function Operator">case_of</a> <a id="1660" class="Symbol">λ</a> <a id="1662" class="Keyword">where</a>
    <a id="1672" class="Comment">{- A -}</a> <a id="1680" class="Symbol">(</a><a id="1681" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="1686" class="Symbol">_)</a>         <a id="1697" class="Symbol">→</a> <a id="1699" href="SecureCompilation.Example.html#1575" class="Postulate">Kᵃ</a>
    <a id="1706" class="Comment">{- B -}</a> <a id="1714" class="Symbol">(</a><a id="1715" href="Data.List.Relation.Unary.Any.html#1227" class="InductiveConstructor">there</a> <a id="1721" class="Symbol">(</a><a id="1722" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="1727" class="Symbol">_))</a> <a id="1731" class="Symbol">→</a> <a id="1733" href="SecureCompilation.Example.html#1578" class="Postulate">Kᵇ</a>

  <a id="Section7.K²"></a><a id="1739" href="SecureCompilation.Example.html#1739" class="Function">K²</a> <a id="1742" class="Symbol">:</a> <a id="1744" href="BitML.Contracts.Helpers.html#9984" class="Function">subterms′</a> <a id="1754" class="Symbol">(</a><a id="1755" href="BitML.Contracts.Induction.html#414" class="InductiveConstructor">CS</a> <a id="1758" href="Function.Base.html#1538" class="Function Operator">$</a> <a id="1760" href="SecureCompilation.Example.html#1116" class="Function">ex-ad</a> <a id="1766" class="Symbol">.</a><a id="1767" href="BitML.Contracts.Types.html#2386" class="Field">C</a><a id="1768" class="Symbol">)</a> <a id="1770" href="Prelude.Lists.html#10340" class="Function Operator">↦</a> <a id="1772" class="Symbol">(</a><a id="1773" href="SecureCompilation.Example.html#1199" class="Function">partG</a> <a id="1779" href="Prelude.Lists.html#10340" class="Function Operator">↦</a> <a id="1781" href="Bitcoin.Crypto.html#321" class="Record">KeyPair</a><a id="1788" class="Symbol">)</a>
  <a id="1792" href="SecureCompilation.Example.html#1739" class="Function">K²</a> <a id="1795" class="Symbol">=</a> <a id="1797" href="Function.Base.html#3544" class="Function Operator">case_of</a> <a id="1805" class="Symbol">λ</a> <a id="1807" class="Keyword">where</a>
    <a id="1817" class="Symbol">(</a><a id="1818" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="1823" class="Symbol">_)</a> <a id="1826" class="Symbol">→</a> <a id="1828" href="Function.Base.html#3544" class="Function Operator">case_of</a> <a id="1836" class="Symbol">λ</a> <a id="1838" class="Keyword">where</a>
      <a id="1850" class="Comment">{- A -}</a> <a id="1858" class="Symbol">(</a><a id="1859" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="1864" class="Symbol">_)</a>         <a id="1875" class="Symbol">→</a> <a id="1877" href="SecureCompilation.Example.html#1595" class="Postulate">Kʷᵇ</a> <a id="1881" href="BitML.Example.Setup.html#234" class="InductiveConstructor">A</a>
      <a id="1889" class="Comment">{- B -}</a> <a id="1897" class="Symbol">(</a><a id="1898" href="Data.List.Relation.Unary.Any.html#1227" class="InductiveConstructor">there</a> <a id="1904" class="Symbol">(</a><a id="1905" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="1910" class="Symbol">_))</a> <a id="1914" class="Symbol">→</a> <a id="1916" href="SecureCompilation.Example.html#1595" class="Postulate">Kʷᵇ</a> <a id="1920" href="BitML.Example.Setup.html#236" class="InductiveConstructor">B</a>

  <a id="Section7.Ks"></a><a id="1925" href="SecureCompilation.Example.html#1925" class="Function">Ks</a> <a id="1928" class="Symbol">:</a> <a id="1930" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="1935" href="Bitcoin.Crypto.html#321" class="Record">KeyPair</a>
  <a id="1945" href="SecureCompilation.Example.html#1925" class="Function">Ks</a> <a id="1948" class="Symbol">=</a> <a id="1950" href="Data.List.Membership.Setoid.html#1123" class="Function">mapWith∈</a> <a id="1959" href="SecureCompilation.Example.html#1199" class="Function">partG</a> <a id="1965" class="Symbol">(</a><a id="1966" href="SecureCompilation.Example.html#1739" class="Function">K²</a> <a id="1969" href="Function.Base.html#1538" class="Function Operator">$</a> <a id="1971" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="1976" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="1980" class="Symbol">)</a>

  <a id="Section7.Tᵢₙᵢₜ"></a><a id="1985" href="SecureCompilation.Example.html#1985" class="Function">Tᵢₙᵢₜ</a> <a id="1991" class="Symbol">:</a> <a id="1993" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="1996" class="Number">2</a> <a id="1998" class="Number">1</a>
  <a id="2002" href="SecureCompilation.Example.html#1985" class="Function">Tᵢₙᵢₜ</a> <a id="2008" class="Symbol">=</a> <a id="2010" class="Keyword">record</a>
    <a id="2021" class="Symbol">{</a> <a id="2023" href="Bitcoin.Tx.Base.html#940" class="Field">inputs</a>  <a id="2031" class="Symbol">=</a> <a id="2033" href="SecureCompilation.Example.html#1252" class="Postulate">Tˣ</a> <a id="2036" href="Data.Vec.Base.html#1014" class="InductiveConstructor Operator">∷</a> <a id="2038" href="SecureCompilation.Example.html#1255" class="Postulate">Tʸ</a> <a id="2041" href="Data.Vec.Base.html#1014" class="InductiveConstructor Operator">∷</a> <a id="2043" href="Data.Vec.Base.html#995" class="InductiveConstructor">[]</a>
    <a id="2050" class="Symbol">;</a> <a id="2052" href="Bitcoin.Tx.Base.html#981" class="Field">wit</a>     <a id="2060" class="Symbol">=</a> <a id="2062" href="Bitcoin.Tx.Crypto.html#552" class="Function">wit⊥</a>
    <a id="2071" class="Symbol">;</a> <a id="2073" href="Bitcoin.Tx.Base.html#1036" class="Field">relLock</a> <a id="2081" class="Symbol">=</a> <a id="2083" href="Data.Vec.Base.html#5745" class="Function">V.replicate</a> <a id="2095" class="Number">0</a>
    <a id="2101" class="Symbol">;</a> <a id="2103" href="Bitcoin.Tx.Base.html#1090" class="Field">outputs</a> <a id="2111" class="Symbol">=</a> <a id="2113" href="Data.Vec.Base.html#5711" class="Function Operator">V.[</a> <a id="2117" href="Bitcoin.Script.Base.html#351" class="InductiveConstructor">Ctx</a> <a id="2121" class="Number">2</a> <a id="2123" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2125" class="Keyword">record</a> <a id="2132" class="Symbol">{</a> <a id="2134" href="Bitcoin.Tx.Base.html#658" class="Field">value</a> <a id="2140" class="Symbol">=</a> <a id="2142" class="Number">2</a><a id="2143" class="Symbol">;</a> <a id="2145" href="Bitcoin.Tx.Base.html#680" class="Field">validator</a> <a id="2155" class="Symbol">=</a> <a id="2157" href="Bitcoin.Script.Base.html#2150" class="InductiveConstructor Operator">ƛ</a> <a id="2159" href="Bitcoin.Script.Base.html#1389" class="InductiveConstructor">versig</a> <a id="2166" href="SecureCompilation.Example.html#1925" class="Function">Ks</a> <a id="2169" class="Symbol">(</a><a id="2170" href="Data.List.Base.html#5754" class="Function">allFin</a> <a id="2177" class="Symbol">_)</a> <a id="2180" class="Symbol">}</a><a id="2181" href="Data.Vec.Base.html#5711" class="Function Operator">]</a>
    <a id="2187" class="Symbol">;</a> <a id="2189" href="Bitcoin.Tx.Base.html#1132" class="Field">absLock</a> <a id="2197" class="Symbol">=</a> <a id="2199" class="Number">0</a> <a id="2201" class="Symbol">}</a>

  <a id="Section7.Tᵇ"></a><a id="2206" href="SecureCompilation.Example.html#2206" class="Function">Tᵇ</a> <a id="2209" class="Symbol">:</a> <a id="2211" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="2214" class="Number">1</a> <a id="2216" class="Number">1</a>
  <a id="2220" href="SecureCompilation.Example.html#2206" class="Function">Tᵇ</a> <a id="2223" class="Symbol">=</a> <a id="2225" href="Bitcoin.Tx.Crypto.html#1043" class="Function">sig⋆</a> <a id="2230" href="Data.Vec.Base.html#5711" class="Function Operator">V.[</a> <a id="2234" href="SecureCompilation.Example.html#1925" class="Function">Ks</a> <a id="2237" href="Data.Vec.Base.html#5711" class="Function Operator">]</a> <a id="2239" class="Keyword">record</a>
    <a id="2250" class="Symbol">{</a> <a id="2252" href="Bitcoin.Tx.Base.html#940" class="Field">inputs</a>  <a id="2260" class="Symbol">=</a> <a id="2262" href="Data.Vec.Base.html#5711" class="Function Operator">V.[</a> <a id="2266" href="Bitcoin.Tx.Crypto.html#720" class="Function">hashTx</a> <a id="2273" class="Symbol">(</a><a id="2274" href="Data.Product.html#2196" class="Function Operator">-,</a> <a id="2277" href="Data.Product.html#2196" class="Function Operator">-,</a> <a id="2280" href="SecureCompilation.Example.html#1985" class="Function">Tᵢₙᵢₜ</a><a id="2285" class="Symbol">)</a> <a id="2287" href="Bitcoin.Tx.Base.html#377" class="InductiveConstructor Operator">at</a> <a id="2290" class="Number">0</a> <a id="2292" href="Data.Vec.Base.html#5711" class="Function Operator">]</a>
    <a id="2298" class="Symbol">;</a> <a id="2300" href="Bitcoin.Tx.Base.html#981" class="Field">wit</a>     <a id="2308" class="Symbol">=</a> <a id="2310" href="Bitcoin.Tx.Crypto.html#552" class="Function">wit⊥</a>
    <a id="2319" class="Symbol">;</a> <a id="2321" href="Bitcoin.Tx.Base.html#1036" class="Field">relLock</a> <a id="2329" class="Symbol">=</a> <a id="2331" href="Data.Vec.Base.html#5745" class="Function">V.replicate</a> <a id="2343" class="Number">0</a>
    <a id="2349" class="Symbol">;</a> <a id="2351" href="Bitcoin.Tx.Base.html#1090" class="Field">outputs</a> <a id="2359" class="Symbol">=</a> <a id="2361" href="Data.Vec.Base.html#5711" class="Function Operator">V.[</a> <a id="2365" href="Bitcoin.Script.Base.html#351" class="InductiveConstructor">Ctx</a> <a id="2369" class="Number">1</a> <a id="2371" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2373" class="Keyword">record</a> <a id="2380" class="Symbol">{</a> <a id="2382" href="Bitcoin.Tx.Base.html#658" class="Field">value</a> <a id="2388" class="Symbol">=</a> <a id="2390" class="Number">2</a><a id="2391" class="Symbol">;</a> <a id="2393" href="Bitcoin.Tx.Base.html#680" class="Field">validator</a> <a id="2403" class="Symbol">=</a> <a id="2405" href="Bitcoin.Script.Base.html#2150" class="InductiveConstructor Operator">ƛ</a> <a id="2407" href="Bitcoin.Script.Base.html#1389" class="InductiveConstructor">versig</a> <a id="2414" href="Data.List.Base.html#4458" class="Function Operator">[</a> <a id="2416" href="SecureCompilation.Example.html#1626" class="Function">K</a> <a id="2418" class="Symbol">(</a><a id="2419" href="Data.List.Relation.Unary.Any.html#1227" class="InductiveConstructor">there</a> <a id="2425" class="Symbol">(</a><a id="2426" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="2431" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="2435" class="Symbol">))</a> <a id="2438" href="Data.List.Base.html#4458" class="Function Operator">]</a> <a id="2440" href="Data.List.Base.html#4458" class="Function Operator">[</a> <a id="2442" href="Data.Fin.Patterns.html#390" class="InductiveConstructor">0F</a> <a id="2445" href="Data.List.Base.html#4458" class="Function Operator">]</a> <a id="2447" class="Symbol">}</a><a id="2448" href="Data.Vec.Base.html#5711" class="Function Operator">]</a>
    <a id="2454" class="Symbol">;</a> <a id="2456" href="Bitcoin.Tx.Base.html#1132" class="Field">absLock</a> <a id="2464" class="Symbol">=</a> <a id="2466" class="Number">0</a> <a id="2468" class="Symbol">}</a>

  <a id="Section7.out"></a><a id="2473" href="SecureCompilation.Example.html#2473" class="Function">out</a> <a id="2477" class="Symbol">:</a> <a id="2479" href="Bitcoin.Tx.Base.html#1255" class="Function">∃Tx</a> <a id="2483" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="2485" class="Symbol">(</a><a id="2486" href="BitML.Contracts.Helpers.html#9974" class="Function">subterms⁺</a> <a id="2496" class="Symbol">(</a><a id="2497" href="BitML.Contracts.Induction.html#414" class="InductiveConstructor">CS</a> <a id="2500" href="Function.Base.html#1538" class="Function Operator">$</a> <a id="2502" href="SecureCompilation.Example.html#1116" class="Function">ex-ad</a> <a id="2508" class="Symbol">.</a><a id="2509" href="BitML.Contracts.Types.html#2386" class="Field">C</a><a id="2510" class="Symbol">)</a> <a id="2512" href="Prelude.Lists.html#10340" class="Function Operator">↦</a> <a id="2514" href="Bitcoin.Tx.Base.html#1255" class="Function">∃Tx</a><a id="2517" class="Symbol">)</a>
  <a id="2521" href="SecureCompilation.Example.html#2473" class="Function">out</a> <a id="2525" class="Symbol">=</a> <a id="2527" href="SecureCompilation.Compiler.html#2440" class="Function">bitml-compiler</a> <a id="2542" class="Symbol">{</a><a id="2543" class="Argument">g</a> <a id="2545" class="Symbol">=</a> <a id="2547" href="SecureCompilation.Example.html#1116" class="Function">ex-ad</a> <a id="2553" class="Symbol">.</a><a id="2554" href="BitML.Contracts.Types.html#2365" class="Field">G</a><a id="2555" class="Symbol">}</a> <a id="2557" class="Symbol">{</a><a id="2558" class="Argument">ds</a> <a id="2561" class="Symbol">=</a> <a id="2563" href="SecureCompilation.Example.html#1116" class="Function">ex-ad</a> <a id="2569" class="Symbol">.</a><a id="2570" href="BitML.Contracts.Types.html#2386" class="Field">C</a><a id="2571" class="Symbol">}</a> <a id="2573" href="SecureCompilation.Example.html#1296" class="Function">valid</a> <a id="2579" href="SecureCompilation.Example.html#1376" class="Function">sechash</a> <a id="2587" href="SecureCompilation.Example.html#1424" class="Function">txout</a> <a id="2593" href="SecureCompilation.Example.html#1626" class="Function">K</a> <a id="2595" href="SecureCompilation.Example.html#1739" class="Function">K²</a>

  <a id="Section7.outTxs"></a><a id="2601" href="SecureCompilation.Example.html#2601" class="Function">outTxs</a> <a id="2608" class="Symbol">:</a> <a id="2610" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="2615" href="Bitcoin.Tx.Base.html#1255" class="Function">∃Tx</a>
  <a id="2621" href="SecureCompilation.Example.html#2601" class="Function">outTxs</a> <a id="2628" class="Symbol">=</a> <a id="2630" class="Keyword">let</a> <a id="2634" href="SecureCompilation.Example.html#2634" class="Bound">t₀</a> <a id="2637" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2639" href="SecureCompilation.Example.html#2639" class="Bound">m</a> <a id="2641" class="Symbol">=</a> <a id="2643" href="SecureCompilation.Example.html#2473" class="Function">out</a> <a id="2647" class="Keyword">in</a> <a id="2650" href="SecureCompilation.Example.html#2634" class="Bound">t₀</a> <a id="2653" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="2655" href="SecureCompilation.Example.html#2639" class="Bound">m</a> <a id="2657" class="Symbol">(</a><a id="2658" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="2663" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="2667" class="Symbol">)</a> <a id="2669" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="2671" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>

  <a id="2677" href="SecureCompilation.Example.html#2677" class="Function">_</a> <a id="2679" class="Symbol">:</a> <a id="2681" href="SecureCompilation.Example.html#2601" class="Function">outTxs</a> <a id="2688" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="2690" class="Symbol">(</a><a id="2691" href="Data.Product.html#2196" class="Function Operator">-,</a> <a id="2694" href="Data.Product.html#2196" class="Function Operator">-,</a> <a id="2697" href="SecureCompilation.Example.html#1985" class="Function">Tᵢₙᵢₜ</a><a id="2702" class="Symbol">)</a> <a id="2704" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="2706" class="Symbol">(</a><a id="2707" href="Data.Product.html#2196" class="Function Operator">-,</a> <a id="2710" href="Data.Product.html#2196" class="Function Operator">-,</a> <a id="2713" href="SecureCompilation.Example.html#2206" class="Function">Tᵇ</a><a id="2715" class="Symbol">)</a> <a id="2717" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="2719" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>
  <a id="2724" class="Symbol">_</a> <a id="2726" class="Symbol">=</a> <a id="2728" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>

<a id="2734" class="Keyword">module</a> <a id="TimedCommitment"></a><a id="2741" href="SecureCompilation.Example.html#2741" class="Module">TimedCommitment</a> <a id="2757" class="Keyword">where</a> <a id="2763" class="Comment">-- (see BitML, Appendix A.5)</a>

  <a id="TimedCommitment.t"></a><a id="2795" href="SecureCompilation.Example.html#2795" class="Function">t</a> <a id="2797" class="Symbol">=</a> <a id="2799" class="Number">42</a> <a id="2802" class="Symbol">;</a> <a id="TimedCommitment.v"></a><a id="2804" href="SecureCompilation.Example.html#2804" class="Function">v</a> <a id="2806" class="Symbol">=</a> <a id="2808" class="Number">1</a> <a id="2810" class="Symbol">;</a> <a id="TimedCommitment.Ha"></a><a id="2812" href="SecureCompilation.Example.html#2812" class="Function">Ha</a> <a id="2815" class="Symbol">=</a> <a id="2817" href="Agda.Builtin.Int.html#264" class="InductiveConstructor Operator">+</a> <a id="2819" class="Number">9</a>

  <a id="TimedCommitment.tc"></a><a id="2824" href="SecureCompilation.Example.html#2824" class="Function">tc</a> <a id="2827" class="Symbol">:</a> <a id="2829" href="BitML.Contracts.Types.html#2308" class="Record">Advertisement</a>
  <a id="2845" href="SecureCompilation.Example.html#2824" class="Function">tc</a> <a id="2848" class="Symbol">=</a> <a id="2850" href="BitML.Contracts.Types.html#2348" class="InductiveConstructor Operator">⟨</a> <a id="2852" href="BitML.Example.Setup.html#234" class="InductiveConstructor">A</a> <a id="2854" href="BitML.Contracts.Types.html#1859" class="InductiveConstructor Operator">:!</a> <a id="2857" href="SecureCompilation.Example.html#2804" class="Function">v</a> <a id="2859" href="BitML.Contracts.Types.html#1859" class="InductiveConstructor Operator">at</a> <a id="2862" class="String">&quot;x&quot;</a> <a id="2866" href="BitML.Contracts.Types.html#2034" class="InductiveConstructor Operator">∣∣</a> <a id="2869" href="BitML.Example.Setup.html#234" class="InductiveConstructor">A</a> <a id="2871" href="BitML.Contracts.Types.html#1966" class="InductiveConstructor Operator">:secret</a> <a id="2879" class="String">&quot;a&quot;</a> <a id="2883" href="BitML.Contracts.Types.html#2034" class="InductiveConstructor Operator">∣∣</a> <a id="2886" href="BitML.Example.Setup.html#236" class="InductiveConstructor">B</a> <a id="2888" href="BitML.Contracts.Types.html#1859" class="InductiveConstructor Operator">:!</a> <a id="2891" class="Number">0</a> <a id="2893" href="BitML.Contracts.Types.html#1859" class="InductiveConstructor Operator">at</a> <a id="2896" class="String">&quot;y&quot;</a> <a id="2900" href="BitML.Contracts.Types.html#2348" class="InductiveConstructor Operator">⟩</a>
         <a id="2911" href="BitML.Contracts.Types.html#1583" class="InductiveConstructor Operator">reveal</a> <a id="2918" href="Data.List.Base.html#4458" class="Function Operator">[</a> <a id="2920" class="String">&quot;a&quot;</a> <a id="2924" href="Data.List.Base.html#4458" class="Function Operator">]</a> <a id="2926" href="BitML.Contracts.Types.html#1583" class="InductiveConstructor Operator">⇒</a> <a id="2928" href="Data.List.Base.html#4458" class="Function Operator">[</a> <a id="2930" href="BitML.Contracts.Types.html#886" class="InductiveConstructor">withdraw</a> <a id="2939" href="BitML.Example.Setup.html#234" class="InductiveConstructor">A</a> <a id="2941" href="Data.List.Base.html#4458" class="Function Operator">]</a>
       <a id="2950" href="BitML.Contracts.Types.html#1310" class="Function Operator">⊕</a> <a id="2952" href="BitML.Contracts.Types.html#1094" class="InductiveConstructor Operator">after</a> <a id="2958" href="SecureCompilation.Example.html#2795" class="Function">t</a> <a id="2960" href="BitML.Contracts.Types.html#1094" class="InductiveConstructor Operator">⇒</a> <a id="2962" href="BitML.Contracts.Types.html#886" class="InductiveConstructor">withdraw</a> <a id="2971" href="BitML.Example.Setup.html#236" class="InductiveConstructor">B</a>
       <a id="2980" href="BitML.Contracts.Types.html#1361" class="Function Operator">∙</a>

  <a id="TimedCommitment.partG"></a><a id="2985" href="SecureCompilation.Example.html#2985" class="Function">partG</a> <a id="2991" class="Symbol">=</a> <a id="2993" href="BitML.Contracts.Helpers.html#2456" class="Function">nub-participants</a> <a id="3010" class="Symbol">(</a><a id="3011" href="SecureCompilation.Example.html#2824" class="Function">tc</a> <a id="3014" class="Symbol">.</a><a id="3015" href="BitML.Contracts.Types.html#2365" class="Field">G</a><a id="3016" class="Symbol">)</a>

  <a id="3021" class="Keyword">postulate</a>
    <a id="TimedCommitment.Tᵃ"></a><a id="3035" href="SecureCompilation.Example.html#3035" class="Postulate">Tᵃ</a> <a id="TimedCommitment.Tᵇ"></a><a id="3038" href="SecureCompilation.Example.html#3038" class="Postulate">Tᵇ</a> <a id="3041" class="Symbol">:</a> <a id="3043" href="Bitcoin.Tx.Base.html#343" class="Record">TxInput</a> <a id="3051" class="Comment">-- pre-existing deposits</a>

  <a id="TimedCommitment.valid"></a><a id="3079" href="SecureCompilation.Example.html#3079" class="Function">valid</a> <a id="3085" class="Symbol">:</a> <a id="3087" href="BitML.Contracts.Validity.html#885" class="Function">ValidAdvertisement</a> <a id="3106" href="SecureCompilation.Example.html#2824" class="Function">tc</a>
  <a id="3111" href="SecureCompilation.Example.html#3079" class="Function">valid</a> <a id="3117" class="Symbol">=</a> <a id="3119" href="Relation.Nullary.Decidable.Core.html#1484" class="Function">toWitness</a> <a id="3129" class="Symbol">{</a><a id="3130" class="Argument">Q</a> <a id="3132" class="Symbol">=</a> <a id="3134" href="BitML.Contracts.Validity.html#1401" class="Function">validAd?</a> <a id="3143" href="SecureCompilation.Example.html#2824" class="Function">tc</a><a id="3145" class="Symbol">}</a> <a id="3147" href="Agda.Builtin.Unit.html#201" class="InductiveConstructor">tt</a>

  <a id="TimedCommitment.sechash"></a><a id="3153" href="SecureCompilation.Example.html#3153" class="Function">sechash</a> <a id="3161" class="Symbol">:</a> <a id="3163" href="BitML.Contracts.Helpers.html#3539" class="Function">namesˡ</a> <a id="3170" class="Symbol">(</a><a id="3171" href="SecureCompilation.Example.html#2824" class="Function">tc</a> <a id="3174" class="Symbol">.</a><a id="3175" href="BitML.Contracts.Types.html#2365" class="Field">G</a><a id="3176" class="Symbol">)</a> <a id="3178" href="Prelude.Lists.html#10340" class="Function Operator">↦</a> <a id="3180" href="Agda.Builtin.Int.html#246" class="Datatype">ℤ</a>
  <a id="3184" href="SecureCompilation.Example.html#3153" class="Function">sechash</a> <a id="3192" class="Symbol">=</a> <a id="3194" href="Function.Base.html#3544" class="Function Operator">case_of</a> <a id="3202" class="Symbol">λ</a> <a id="3204" class="Keyword">where</a>
    <a id="3214" class="Comment">{- &quot;a&quot; -}</a> <a id="3224" class="Symbol">(</a><a id="3225" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="3230" class="Symbol">_)</a> <a id="3233" class="Symbol">→</a> <a id="3235" href="SecureCompilation.Example.html#2812" class="Function">Ha</a>

  <a id="TimedCommitment.txout"></a><a id="3241" href="SecureCompilation.Example.html#3241" class="Function">txout</a> <a id="3247" class="Symbol">:</a> <a id="3249" href="BitML.Contracts.Helpers.html#3608" class="Function">namesʳ</a> <a id="3256" class="Symbol">(</a><a id="3257" href="SecureCompilation.Example.html#2824" class="Function">tc</a> <a id="3260" class="Symbol">.</a><a id="3261" href="BitML.Contracts.Types.html#2365" class="Field">G</a><a id="3262" class="Symbol">)</a> <a id="3264" href="Prelude.Lists.html#10340" class="Function Operator">↦</a> <a id="3266" href="Bitcoin.Tx.Base.html#343" class="Record">TxInput</a>
  <a id="3276" href="SecureCompilation.Example.html#3241" class="Function">txout</a> <a id="3282" class="Symbol">=</a> <a id="3284" href="Function.Base.html#3544" class="Function Operator">case_of</a> <a id="3292" class="Symbol">λ</a> <a id="3294" class="Keyword">where</a>
    <a id="3304" class="Comment">{- &quot;x&quot; -}</a> <a id="3314" class="Symbol">(</a><a id="3315" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="3320" class="Symbol">_)</a>         <a id="3331" class="Symbol">→</a> <a id="3333" href="SecureCompilation.Example.html#3035" class="Postulate">Tᵃ</a>
    <a id="3340" class="Comment">{- &quot;y&quot; -}</a> <a id="3350" class="Symbol">(</a><a id="3351" href="Data.List.Relation.Unary.Any.html#1227" class="InductiveConstructor">there</a> <a id="3357" class="Symbol">(</a><a id="3358" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="3363" class="Symbol">_))</a> <a id="3367" class="Symbol">→</a> <a id="3369" href="SecureCompilation.Example.html#3038" class="Postulate">Tᵇ</a>

  <a id="3375" class="Keyword">postulate</a>
    <a id="TimedCommitment.Kᵃ"></a><a id="3389" href="SecureCompilation.Example.html#3389" class="Postulate">Kᵃ</a> <a id="TimedCommitment.Kᵇ"></a><a id="3392" href="SecureCompilation.Example.html#3392" class="Postulate">Kᵇ</a> <a id="3395" class="Symbol">:</a> <a id="3397" href="Bitcoin.Crypto.html#321" class="Record">KeyPair</a>
    <a id="TimedCommitment.Kᵈ¹"></a><a id="3409" href="SecureCompilation.Example.html#3409" class="Postulate">Kᵈ¹</a> <a id="TimedCommitment.Kᵈ²"></a><a id="3413" href="SecureCompilation.Example.html#3413" class="Postulate">Kᵈ²</a> <a id="TimedCommitment.Kʷᵃ"></a><a id="3417" href="SecureCompilation.Example.html#3417" class="Postulate">Kʷᵃ</a> <a id="3421" class="Symbol">:</a> <a id="3423" href="BitML.Example.Setup.html#208" class="Datatype">Participant</a> <a id="3435" class="Symbol">→</a> <a id="3437" href="Bitcoin.Crypto.html#321" class="Record">KeyPair</a>

  <a id="TimedCommitment.K"></a><a id="3448" href="SecureCompilation.Example.html#3448" class="Function">K</a> <a id="3450" class="Symbol">:</a> <a id="3452" href="SecureCompilation.Example.html#2985" class="Function">partG</a> <a id="3458" href="Prelude.Lists.html#10340" class="Function Operator">↦</a> <a id="3460" href="Bitcoin.Crypto.html#321" class="Record">KeyPair</a>
  <a id="3470" href="SecureCompilation.Example.html#3448" class="Function">K</a> <a id="3472" class="Symbol">=</a> <a id="3474" href="Function.Base.html#3544" class="Function Operator">case_of</a> <a id="3482" class="Symbol">λ</a> <a id="3484" class="Keyword">where</a>
    <a id="3494" class="Comment">{- A -}</a> <a id="3502" class="Symbol">(</a><a id="3503" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="3508" class="Symbol">_)</a>         <a id="3519" class="Symbol">→</a> <a id="3521" href="SecureCompilation.Example.html#3389" class="Postulate">Kᵃ</a>
    <a id="3528" class="Comment">{- B -}</a> <a id="3536" class="Symbol">(</a><a id="3537" href="Data.List.Relation.Unary.Any.html#1227" class="InductiveConstructor">there</a> <a id="3543" class="Symbol">(</a><a id="3544" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="3549" class="Symbol">_))</a> <a id="3553" class="Symbol">→</a> <a id="3555" href="SecureCompilation.Example.html#3392" class="Postulate">Kᵇ</a>

  <a id="TimedCommitment.K²"></a><a id="3561" href="SecureCompilation.Example.html#3561" class="Function">K²</a> <a id="3564" class="Symbol">:</a> <a id="3566" href="BitML.Contracts.Helpers.html#9984" class="Function">subterms′</a> <a id="3576" class="Symbol">(</a><a id="3577" href="BitML.Contracts.Induction.html#414" class="InductiveConstructor">CS</a> <a id="3580" href="Function.Base.html#1538" class="Function Operator">$</a> <a id="3582" href="SecureCompilation.Example.html#2824" class="Function">tc</a> <a id="3585" class="Symbol">.</a><a id="3586" href="BitML.Contracts.Types.html#2386" class="Field">C</a><a id="3587" class="Symbol">)</a> <a id="3589" href="Prelude.Lists.html#10340" class="Function Operator">↦</a> <a id="3591" class="Symbol">(</a><a id="3592" href="SecureCompilation.Example.html#2985" class="Function">partG</a> <a id="3598" href="Prelude.Lists.html#10340" class="Function Operator">↦</a> <a id="3600" href="Bitcoin.Crypto.html#321" class="Record">KeyPair</a><a id="3607" class="Symbol">)</a>
  <a id="3611" href="SecureCompilation.Example.html#3561" class="Function">K²</a> <a id="3614" class="Symbol">=</a> <a id="3616" href="Function.Base.html#3544" class="Function Operator">case_of</a> <a id="3624" class="Symbol">λ</a> <a id="3626" class="Keyword">where</a>
    <a id="3636" class="Comment">{- reveal &quot;a&quot; ⇒ withdraw A -}</a>
    <a id="3670" class="Symbol">(</a><a id="3671" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="3676" class="Symbol">_)</a> <a id="3679" class="Symbol">→</a> <a id="3681" href="Function.Base.html#3544" class="Function Operator">case_of</a> <a id="3689" class="Symbol">λ</a> <a id="3691" class="Keyword">where</a>
      <a id="3703" class="Comment">{- A -}</a> <a id="3711" class="Symbol">(</a><a id="3712" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="3717" class="Symbol">_)</a>         <a id="3728" class="Symbol">→</a> <a id="3730" href="SecureCompilation.Example.html#3413" class="Postulate">Kᵈ²</a> <a id="3734" href="BitML.Example.Setup.html#234" class="InductiveConstructor">A</a>
      <a id="3742" class="Comment">{- B -}</a> <a id="3750" class="Symbol">(</a><a id="3751" href="Data.List.Relation.Unary.Any.html#1227" class="InductiveConstructor">there</a> <a id="3757" class="Symbol">(</a><a id="3758" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="3763" class="Symbol">_))</a> <a id="3767" class="Symbol">→</a> <a id="3769" href="SecureCompilation.Example.html#3413" class="Postulate">Kᵈ²</a> <a id="3773" href="BitML.Example.Setup.html#236" class="InductiveConstructor">B</a>
    <a id="3779" class="Comment">{- withdraw A -}</a>
    <a id="3800" class="Symbol">(</a><a id="3801" href="Data.List.Relation.Unary.Any.html#1227" class="InductiveConstructor">there</a> <a id="3807" class="Symbol">(</a><a id="3808" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="3813" class="Symbol">_))</a> <a id="3817" class="Symbol">→</a> <a id="3819" href="Function.Base.html#3544" class="Function Operator">case_of</a> <a id="3827" class="Symbol">λ</a> <a id="3829" class="Keyword">where</a>
      <a id="3841" class="Comment">{- A -}</a> <a id="3849" class="Symbol">(</a><a id="3850" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="3855" class="Symbol">_)</a>         <a id="3866" class="Symbol">→</a> <a id="3868" href="SecureCompilation.Example.html#3417" class="Postulate">Kʷᵃ</a> <a id="3872" href="BitML.Example.Setup.html#234" class="InductiveConstructor">A</a>
      <a id="3880" class="Comment">{- B -}</a> <a id="3888" class="Symbol">(</a><a id="3889" href="Data.List.Relation.Unary.Any.html#1227" class="InductiveConstructor">there</a> <a id="3895" class="Symbol">(</a><a id="3896" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="3901" class="Symbol">_))</a> <a id="3905" class="Symbol">→</a> <a id="3907" href="SecureCompilation.Example.html#3417" class="Postulate">Kʷᵃ</a> <a id="3911" href="BitML.Example.Setup.html#236" class="InductiveConstructor">B</a>
    <a id="3917" class="Comment">{- after t ⇒ withdraw B -}</a>
    <a id="3948" class="Symbol">(</a><a id="3949" href="Data.List.Relation.Unary.Any.html#1227" class="InductiveConstructor">there</a> <a id="3955" class="Symbol">(</a><a id="3956" href="Data.List.Relation.Unary.Any.html#1227" class="InductiveConstructor">there</a> <a id="3962" class="Symbol">(</a><a id="3963" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="3968" class="Symbol">_)))</a> <a id="3973" class="Symbol">→</a> <a id="3975" href="Function.Base.html#3544" class="Function Operator">case_of</a> <a id="3983" class="Symbol">λ</a> <a id="3985" class="Keyword">where</a>
      <a id="3997" class="Comment">{- A -}</a> <a id="4005" class="Symbol">(</a><a id="4006" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="4011" class="Symbol">_)</a>         <a id="4022" class="Symbol">→</a> <a id="4024" href="SecureCompilation.Example.html#3413" class="Postulate">Kᵈ²</a> <a id="4028" href="BitML.Example.Setup.html#234" class="InductiveConstructor">A</a>
      <a id="4036" class="Comment">{- B -}</a> <a id="4044" class="Symbol">(</a><a id="4045" href="Data.List.Relation.Unary.Any.html#1227" class="InductiveConstructor">there</a> <a id="4051" class="Symbol">(</a><a id="4052" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="4057" class="Symbol">_))</a> <a id="4061" class="Symbol">→</a> <a id="4063" href="SecureCompilation.Example.html#3413" class="Postulate">Kᵈ²</a> <a id="4067" href="BitML.Example.Setup.html#236" class="InductiveConstructor">B</a>

  <a id="TimedCommitment.K⋆"></a><a id="4072" href="SecureCompilation.Example.html#4072" class="Function">K⋆</a> <a id="4075" class="Symbol">:</a> <a id="4077" href="BitML.Contracts.Helpers.html#9984" class="Function">subterms′</a> <a id="4087" class="Symbol">(</a><a id="4088" href="BitML.Contracts.Induction.html#414" class="InductiveConstructor">CS</a> <a id="4091" href="Function.Base.html#1538" class="Function Operator">$</a> <a id="4093" href="SecureCompilation.Example.html#2824" class="Function">tc</a> <a id="4096" class="Symbol">.</a><a id="4097" href="BitML.Contracts.Types.html#2386" class="Field">C</a><a id="4098" class="Symbol">)</a> <a id="4100" href="Prelude.Lists.html#10340" class="Function Operator">↦</a> <a id="4102" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="4107" href="Bitcoin.Crypto.html#321" class="Record">KeyPair</a>
  <a id="4117" href="SecureCompilation.Example.html#4072" class="Function">K⋆</a> <a id="4120" class="Symbol">=</a> <a id="4122" href="Data.List.Membership.Setoid.html#1123" class="Function">mapWith∈</a> <a id="4131" href="SecureCompilation.Example.html#2985" class="Function">partG</a> <a id="4137" href="Function.Base.html#992" class="Function Operator">∘</a> <a id="4139" href="SecureCompilation.Example.html#3561" class="Function">K²</a>

  <a id="TimedCommitment.e₁"></a><a id="4145" href="SecureCompilation.Example.html#4145" class="Function">e₁</a> <a id="4148" class="Symbol">:</a> <a id="4150" href="Bitcoin.Script.Base.html#677" class="Datatype">Script</a> <a id="4157" class="Symbol">(</a><a id="4158" href="Bitcoin.Script.Base.html#351" class="InductiveConstructor">Ctx</a> <a id="4162" class="Number">3</a><a id="4163" class="Symbol">)</a> <a id="4165" href="Bitcoin.Script.Base.html#524" class="InductiveConstructor">`Bool</a>
  <a id="4173" href="SecureCompilation.Example.html#4145" class="Function">e₁</a> <a id="4176" class="Symbol">=</a> <a id="4178" href="Bitcoin.Script.Base.html#1389" class="InductiveConstructor">versig</a> <a id="4185" class="Symbol">(</a><a id="4186" href="SecureCompilation.Example.html#4072" class="Function">K⋆</a> <a id="4189" href="Function.Base.html#1538" class="Function Operator">$</a> <a id="4191" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="4196" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="4200" class="Symbol">)</a> <a id="4202" href="Prelude.Nary.html#161" class="Function Operator">⟦</a> <a id="4204" href="Data.Fin.html#730" class="Function Operator">#</a> <a id="4206" class="Number">0</a> <a id="4208" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4210" href="Data.Fin.html#730" class="Function Operator">#</a> <a id="4212" class="Number">1</a> <a id="4214" href="Prelude.Nary.html#161" class="Function Operator">⟧</a>
    <a id="4220" href="Bitcoin.Script.Base.html#1816" class="Function Operator">`∧</a> <a id="4223" href="Bitcoin.Script.Base.html#1763" class="Function">`true</a>
    <a id="4233" href="Bitcoin.Script.Base.html#1816" class="Function Operator">`∧</a> <a id="4236" href="Bitcoin.Script.Base.html#3705" class="Function">⋀</a> <a id="4238" href="Data.List.Base.html#4458" class="Function Operator">[</a> <a id="4240" href="Bitcoin.Script.Base.html#1321" class="InductiveConstructor">hash</a> <a id="4245" class="Symbol">(</a><a id="4246" href="Bitcoin.Script.Base.html#822" class="InductiveConstructor">var</a> <a id="4250" class="Symbol">(</a><a id="4251" href="Data.Fin.html#730" class="Function Operator">#</a> <a id="4253" class="Number">2</a><a id="4254" class="Symbol">))</a> <a id="4257" href="Bitcoin.Script.Base.html#1030" class="InductiveConstructor Operator">`=</a> <a id="4260" href="Bitcoin.Script.Base.html#893" class="InductiveConstructor">`</a> <a id="4262" class="Symbol">(</a><a id="4263" href="SecureCompilation.Example.html#3153" class="Function">sechash</a> <a id="4271" class="Symbol">(</a><a id="4272" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="4277" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="4281" class="Symbol">))</a> <a id="4284" href="Bitcoin.Script.Base.html#1816" class="Function Operator">`∧</a> <a id="4287" class="Symbol">(</a><a id="4288" href="Bitcoin.Script.Base.html#893" class="InductiveConstructor">`</a> <a id="4290" class="Symbol">(</a><a id="4291" href="Agda.Builtin.Int.html#264" class="InductiveConstructor Operator">+</a> <a id="4293" href="SecureCompilation.Example.html#991" class="Function">η</a><a id="4294" class="Symbol">)</a> <a id="4296" href="Bitcoin.Script.Base.html#1088" class="InductiveConstructor Operator">`&lt;</a> <a id="4299" href="Bitcoin.Script.Base.html#1269" class="InductiveConstructor Operator">∣</a> <a id="4301" href="Bitcoin.Script.Base.html#822" class="InductiveConstructor">var</a> <a id="4305" class="Symbol">(</a><a id="4306" href="Data.Fin.html#730" class="Function Operator">#</a> <a id="4308" class="Number">2</a><a id="4309" class="Symbol">)</a> <a id="4311" href="Bitcoin.Script.Base.html#1269" class="InductiveConstructor Operator">∣</a><a id="4312" class="Symbol">)</a> <a id="4314" href="Data.List.Base.html#4458" class="Function Operator">]</a>

  <a id="TimedCommitment.e₂"></a><a id="4319" href="SecureCompilation.Example.html#4319" class="Function">e₂</a> <a id="4322" class="Symbol">:</a> <a id="4324" href="Bitcoin.Script.Base.html#677" class="Datatype">Script</a> <a id="4331" class="Symbol">(</a><a id="4332" href="Bitcoin.Script.Base.html#351" class="InductiveConstructor">Ctx</a> <a id="4336" class="Number">3</a><a id="4337" class="Symbol">)</a> <a id="4339" href="Bitcoin.Script.Base.html#524" class="InductiveConstructor">`Bool</a>
  <a id="4347" href="SecureCompilation.Example.html#4319" class="Function">e₂</a> <a id="4350" class="Symbol">=</a> <a id="4352" href="Bitcoin.Script.Base.html#1389" class="InductiveConstructor">versig</a> <a id="4359" class="Symbol">(</a><a id="4360" href="SecureCompilation.Example.html#4072" class="Function">K⋆</a> <a id="4363" href="Function.Base.html#1538" class="Function Operator">$</a> <a id="4365" href="Data.List.Relation.Unary.Any.html#1227" class="InductiveConstructor">there</a> <a id="4371" class="Symbol">(</a><a id="4372" href="Data.List.Relation.Unary.Any.html#1227" class="InductiveConstructor">there</a> <a id="4378" class="Symbol">(</a><a id="4379" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="4384" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="4388" class="Symbol">)))</a> <a id="4392" href="Prelude.Nary.html#161" class="Function Operator">⟦</a> <a id="4394" href="Data.Fin.html#730" class="Function Operator">#</a> <a id="4396" class="Number">0</a> <a id="4398" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4400" href="Data.Fin.html#730" class="Function Operator">#</a> <a id="4402" class="Number">1</a> <a id="4404" href="Prelude.Nary.html#161" class="Function Operator">⟧</a>

  <a id="TimedCommitment.e′"></a><a id="4409" href="SecureCompilation.Example.html#4409" class="Function">e′</a> <a id="4412" class="Symbol">:</a> <a id="4414" href="Bitcoin.Script.Base.html#677" class="Datatype">Script</a> <a id="4421" class="Symbol">(</a><a id="4422" href="Bitcoin.Script.Base.html#351" class="InductiveConstructor">Ctx</a> <a id="4426" class="Number">2</a><a id="4427" class="Symbol">)</a> <a id="4429" href="Bitcoin.Script.Base.html#524" class="InductiveConstructor">`Bool</a>
  <a id="4437" href="SecureCompilation.Example.html#4409" class="Function">e′</a> <a id="4440" class="Symbol">=</a> <a id="4442" href="Bitcoin.Script.Base.html#1389" class="InductiveConstructor">versig</a> <a id="4449" class="Symbol">(</a><a id="4450" href="SecureCompilation.Example.html#4072" class="Function">K⋆</a> <a id="4453" href="Function.Base.html#1538" class="Function Operator">$</a> <a id="4455" href="Data.List.Relation.Unary.Any.html#1227" class="InductiveConstructor">there</a> <a id="4461" class="Symbol">(</a><a id="4462" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="4467" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="4471" class="Symbol">))</a> <a id="4474" href="Prelude.Nary.html#161" class="Function Operator">⟦</a> <a id="4476" href="Data.Fin.html#730" class="Function Operator">#</a> <a id="4478" class="Number">0</a> <a id="4480" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4482" href="Data.Fin.html#730" class="Function Operator">#</a> <a id="4484" class="Number">1</a> <a id="4486" href="Prelude.Nary.html#161" class="Function Operator">⟧</a>

  <a id="TimedCommitment.Tᵢₙᵢₜ"></a><a id="4491" href="SecureCompilation.Example.html#4491" class="Function">Tᵢₙᵢₜ</a> <a id="4497" class="Symbol">:</a> <a id="4499" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="4502" class="Number">2</a> <a id="4504" class="Number">1</a>
  <a id="4508" href="SecureCompilation.Example.html#4491" class="Function">Tᵢₙᵢₜ</a> <a id="4514" class="Symbol">=</a> <a id="4516" class="Keyword">record</a>
    <a id="4527" class="Symbol">{</a> <a id="4529" href="Bitcoin.Tx.Base.html#940" class="Field">inputs</a>   <a id="4538" class="Symbol">=</a> <a id="4540" href="SecureCompilation.Example.html#3035" class="Postulate">Tᵃ</a> <a id="4543" href="Data.Vec.Base.html#1014" class="InductiveConstructor Operator">∷</a> <a id="4545" href="SecureCompilation.Example.html#3038" class="Postulate">Tᵇ</a> <a id="4548" href="Data.Vec.Base.html#1014" class="InductiveConstructor Operator">∷</a> <a id="4550" href="Data.Vec.Base.html#995" class="InductiveConstructor">[]</a>
    <a id="4557" class="Symbol">;</a> <a id="4559" href="Bitcoin.Tx.Base.html#981" class="Field">wit</a>     <a id="4567" class="Symbol">=</a> <a id="4569" href="Bitcoin.Tx.Crypto.html#552" class="Function">wit⊥</a>
    <a id="4578" class="Symbol">;</a> <a id="4580" href="Bitcoin.Tx.Base.html#1036" class="Field">relLock</a> <a id="4588" class="Symbol">=</a> <a id="4590" href="Data.Vec.Base.html#5745" class="Function">V.replicate</a> <a id="4602" class="Number">0</a>
    <a id="4608" class="Symbol">;</a> <a id="4610" href="Bitcoin.Tx.Base.html#1090" class="Field">outputs</a> <a id="4618" class="Symbol">=</a> <a id="4620" href="Data.Vec.Base.html#5711" class="Function Operator">V.[</a> <a id="4624" class="Symbol">_</a> <a id="4626" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4628" class="Keyword">record</a> <a id="4635" class="Symbol">{</a> <a id="4637" href="Bitcoin.Tx.Base.html#658" class="Field">value</a> <a id="4643" class="Symbol">=</a> <a id="4645" href="SecureCompilation.Example.html#2804" class="Function">v</a> <a id="4647" class="Symbol">;</a> <a id="4649" href="Bitcoin.Tx.Base.html#680" class="Field">validator</a> <a id="4659" class="Symbol">=</a> <a id="4661" href="Bitcoin.Script.Base.html#2150" class="InductiveConstructor Operator">ƛ</a> <a id="4663" class="Symbol">(</a><a id="4664" href="SecureCompilation.Example.html#4145" class="Function">e₁</a> <a id="4667" href="Bitcoin.Script.Base.html#1915" class="Function Operator">`∨</a> <a id="4670" href="SecureCompilation.Example.html#4319" class="Function">e₂</a><a id="4672" class="Symbol">)</a> <a id="4674" class="Symbol">}</a><a id="4675" href="Data.Vec.Base.html#5711" class="Function Operator">]</a>
    <a id="4681" class="Symbol">;</a> <a id="4683" href="Bitcoin.Tx.Base.html#1132" class="Field">absLock</a> <a id="4691" class="Symbol">=</a> <a id="4693" class="Number">0</a> <a id="4695" class="Symbol">}</a>
  <a id="TimedCommitment.Tᵢₙᵢₜ♯"></a><a id="4699" href="SecureCompilation.Example.html#4699" class="Function">Tᵢₙᵢₜ♯</a> <a id="4706" class="Symbol">=</a> <a id="4708" href="Bitcoin.Tx.Crypto.html#720" class="Function">hashTx</a> <a id="4715" class="Symbol">(</a><a id="4716" href="Data.Product.html#2196" class="Function Operator">-,</a> <a id="4719" href="Data.Product.html#2196" class="Function Operator">-,</a> <a id="4722" href="SecureCompilation.Example.html#4491" class="Function">Tᵢₙᵢₜ</a><a id="4727" class="Symbol">)</a>

  <a id="TimedCommitment.T′"></a><a id="4732" href="SecureCompilation.Example.html#4732" class="Function">T′</a> <a id="4735" class="Symbol">:</a> <a id="4737" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="4740" class="Number">1</a> <a id="4742" class="Number">1</a>
  <a id="4746" href="SecureCompilation.Example.html#4732" class="Function">T′</a> <a id="4749" class="Symbol">=</a> <a id="4751" href="Bitcoin.Tx.Crypto.html#1043" class="Function">sig⋆</a> <a id="4756" href="Data.Vec.Base.html#5711" class="Function Operator">V.[</a> <a id="4760" href="SecureCompilation.Example.html#4072" class="Function">K⋆</a> <a id="4763" href="Function.Base.html#1538" class="Function Operator">$</a> <a id="4765" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="4770" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a> <a id="4775" href="Data.Vec.Base.html#5711" class="Function Operator">]</a> <a id="4777" class="Keyword">record</a>
    <a id="4788" class="Symbol">{</a> <a id="4790" href="Bitcoin.Tx.Base.html#940" class="Field">inputs</a>  <a id="4798" class="Symbol">=</a> <a id="4800" href="Data.Vec.Base.html#5711" class="Function Operator">V.[</a> <a id="4804" href="SecureCompilation.Example.html#4699" class="Function">Tᵢₙᵢₜ♯</a> <a id="4811" href="Bitcoin.Tx.Base.html#377" class="InductiveConstructor Operator">at</a> <a id="4814" class="Number">0</a> <a id="4816" href="Data.Vec.Base.html#5711" class="Function Operator">]</a>
    <a id="4822" class="Symbol">;</a> <a id="4824" href="Bitcoin.Tx.Base.html#981" class="Field">wit</a>     <a id="4832" class="Symbol">=</a> <a id="4834" href="Bitcoin.Tx.Crypto.html#552" class="Function">wit⊥</a>
    <a id="4843" class="Symbol">;</a> <a id="4845" href="Bitcoin.Tx.Base.html#1036" class="Field">relLock</a> <a id="4853" class="Symbol">=</a> <a id="4855" href="Data.Vec.Base.html#5745" class="Function">V.replicate</a> <a id="4867" class="Number">0</a>
    <a id="4873" class="Symbol">;</a> <a id="4875" href="Bitcoin.Tx.Base.html#1090" class="Field">outputs</a> <a id="4883" class="Symbol">=</a> <a id="4885" href="Data.Vec.Base.html#5711" class="Function Operator">V.[</a> <a id="4889" class="Symbol">_</a> <a id="4891" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4893" class="Keyword">record</a> <a id="4900" class="Symbol">{</a> <a id="4902" href="Bitcoin.Tx.Base.html#658" class="Field">value</a> <a id="4908" class="Symbol">=</a> <a id="4910" href="SecureCompilation.Example.html#2804" class="Function">v</a> <a id="4912" class="Symbol">;</a> <a id="4914" href="Bitcoin.Tx.Base.html#680" class="Field">validator</a> <a id="4924" class="Symbol">=</a> <a id="4926" href="Bitcoin.Script.Base.html#2150" class="InductiveConstructor Operator">ƛ</a> <a id="4928" href="SecureCompilation.Example.html#4409" class="Function">e′</a> <a id="4931" class="Symbol">}</a><a id="4932" href="Data.Vec.Base.html#5711" class="Function Operator">]</a>
    <a id="4938" class="Symbol">;</a> <a id="4940" href="Bitcoin.Tx.Base.html#1132" class="Field">absLock</a> <a id="4948" class="Symbol">=</a> <a id="4950" class="Number">0</a> <a id="4952" class="Symbol">}</a>

  <a id="TimedCommitment.T′ᵃ"></a><a id="4957" href="SecureCompilation.Example.html#4957" class="Function">T′ᵃ</a> <a id="4961" class="Symbol">:</a> <a id="4963" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="4966" class="Number">1</a> <a id="4968" class="Number">1</a>
  <a id="4972" href="SecureCompilation.Example.html#4957" class="Function">T′ᵃ</a> <a id="4976" class="Symbol">=</a> <a id="4978" href="Bitcoin.Tx.Crypto.html#1043" class="Function">sig⋆</a> <a id="4983" href="Data.Vec.Base.html#5711" class="Function Operator">V.[</a> <a id="4987" href="SecureCompilation.Example.html#4072" class="Function">K⋆</a> <a id="4990" href="Function.Base.html#1538" class="Function Operator">$</a> <a id="4992" href="Data.List.Relation.Unary.Any.html#1227" class="InductiveConstructor">there</a> <a id="4998" class="Symbol">(</a><a id="4999" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="5004" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="5008" class="Symbol">)</a> <a id="5010" href="Data.Vec.Base.html#5711" class="Function Operator">]</a> <a id="5012" class="Keyword">record</a>
    <a id="5023" class="Symbol">{</a> <a id="5025" href="Bitcoin.Tx.Base.html#940" class="Field">inputs</a>  <a id="5033" class="Symbol">=</a> <a id="5035" href="Data.Vec.Base.html#5711" class="Function Operator">V.[</a> <a id="5039" href="Bitcoin.Tx.Crypto.html#720" class="Function">hashTx</a> <a id="5046" class="Symbol">(</a><a id="5047" href="Data.Product.html#2196" class="Function Operator">-,</a> <a id="5050" href="Data.Product.html#2196" class="Function Operator">-,</a> <a id="5053" href="SecureCompilation.Example.html#4732" class="Function">T′</a><a id="5055" class="Symbol">)</a> <a id="5057" href="Bitcoin.Tx.Base.html#377" class="InductiveConstructor Operator">at</a> <a id="5060" class="Number">0</a> <a id="5062" href="Data.Vec.Base.html#5711" class="Function Operator">]</a>
    <a id="5068" class="Symbol">;</a> <a id="5070" href="Bitcoin.Tx.Base.html#981" class="Field">wit</a>     <a id="5078" class="Symbol">=</a> <a id="5080" href="Bitcoin.Tx.Crypto.html#552" class="Function">wit⊥</a>
    <a id="5089" class="Symbol">;</a> <a id="5091" href="Bitcoin.Tx.Base.html#1036" class="Field">relLock</a> <a id="5099" class="Symbol">=</a> <a id="5101" href="Data.Vec.Base.html#5745" class="Function">V.replicate</a> <a id="5113" class="Number">0</a>
    <a id="5119" class="Symbol">;</a> <a id="5121" href="Bitcoin.Tx.Base.html#1090" class="Field">outputs</a> <a id="5129" class="Symbol">=</a> <a id="5131" href="Data.Vec.Base.html#5711" class="Function Operator">V.[</a> <a id="5135" href="Bitcoin.Script.Base.html#351" class="InductiveConstructor">Ctx</a> <a id="5139" class="Number">1</a> <a id="5141" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5143" class="Keyword">record</a> <a id="5150" class="Symbol">{</a> <a id="5152" href="Bitcoin.Tx.Base.html#658" class="Field">value</a> <a id="5158" class="Symbol">=</a> <a id="5160" href="SecureCompilation.Example.html#2804" class="Function">v</a> <a id="5162" class="Symbol">;</a> <a id="5164" href="Bitcoin.Tx.Base.html#680" class="Field">validator</a> <a id="5174" class="Symbol">=</a> <a id="5176" href="Bitcoin.Script.Base.html#2150" class="InductiveConstructor Operator">ƛ</a> <a id="5178" href="Bitcoin.Script.Base.html#1389" class="InductiveConstructor">versig</a> <a id="5185" href="Data.List.Base.html#4458" class="Function Operator">[</a> <a id="5187" href="SecureCompilation.Example.html#3448" class="Function">K</a> <a id="5189" href="Function.Base.html#1538" class="Function Operator">$</a> <a id="5191" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="5196" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a> <a id="5201" href="Data.List.Base.html#4458" class="Function Operator">]</a> <a id="5203" href="Data.List.Base.html#4458" class="Function Operator">[</a> <a id="5205" href="Data.Fin.html#730" class="Function Operator">#</a> <a id="5207" class="Number">0</a> <a id="5209" href="Data.List.Base.html#4458" class="Function Operator">]</a> <a id="5211" class="Symbol">}</a><a id="5212" href="Data.Vec.Base.html#5711" class="Function Operator">]</a>
    <a id="5218" class="Symbol">;</a> <a id="5220" href="Bitcoin.Tx.Base.html#1132" class="Field">absLock</a> <a id="5228" class="Symbol">=</a> <a id="5230" class="Number">0</a> <a id="5232" class="Symbol">}</a>

  <a id="TimedCommitment.T′ᵇ"></a><a id="5237" href="SecureCompilation.Example.html#5237" class="Function">T′ᵇ</a> <a id="5241" class="Symbol">:</a> <a id="5243" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="5246" class="Number">1</a> <a id="5248" class="Number">1</a>
  <a id="5252" href="SecureCompilation.Example.html#5237" class="Function">T′ᵇ</a> <a id="5256" class="Symbol">=</a> <a id="5258" href="Bitcoin.Tx.Crypto.html#1043" class="Function">sig⋆</a> <a id="5263" href="Data.Vec.Base.html#5711" class="Function Operator">V.[</a> <a id="5267" href="SecureCompilation.Example.html#4072" class="Function">K⋆</a> <a id="5270" href="Function.Base.html#1538" class="Function Operator">$</a> <a id="5272" href="Data.List.Relation.Unary.Any.html#1227" class="InductiveConstructor">there</a> <a id="5278" class="Symbol">(</a><a id="5279" href="Data.List.Relation.Unary.Any.html#1227" class="InductiveConstructor">there</a> <a id="5285" class="Symbol">(</a><a id="5286" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="5291" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="5295" class="Symbol">))</a> <a id="5298" href="Data.Vec.Base.html#5711" class="Function Operator">]</a> <a id="5300" class="Keyword">record</a>
    <a id="5311" class="Symbol">{</a> <a id="5313" href="Bitcoin.Tx.Base.html#940" class="Field">inputs</a>  <a id="5321" class="Symbol">=</a> <a id="5323" href="Data.Vec.Base.html#5711" class="Function Operator">V.[</a> <a id="5327" href="SecureCompilation.Example.html#4699" class="Function">Tᵢₙᵢₜ♯</a> <a id="5334" href="Bitcoin.Tx.Base.html#377" class="InductiveConstructor Operator">at</a> <a id="5337" class="Number">0</a> <a id="5339" href="Data.Vec.Base.html#5711" class="Function Operator">]</a>
    <a id="5345" class="Symbol">;</a> <a id="5347" href="Bitcoin.Tx.Base.html#981" class="Field">wit</a>     <a id="5355" class="Symbol">=</a> <a id="5357" href="Bitcoin.Tx.Crypto.html#552" class="Function">wit⊥</a>
    <a id="5366" class="Symbol">;</a> <a id="5368" href="Bitcoin.Tx.Base.html#1036" class="Field">relLock</a> <a id="5376" class="Symbol">=</a> <a id="5378" href="Data.Vec.Base.html#5745" class="Function">V.replicate</a> <a id="5390" class="Number">0</a>
    <a id="5396" class="Symbol">;</a> <a id="5398" href="Bitcoin.Tx.Base.html#1090" class="Field">outputs</a> <a id="5406" class="Symbol">=</a> <a id="5408" href="Data.Vec.Base.html#5711" class="Function Operator">V.[</a> <a id="5412" href="Bitcoin.Script.Base.html#351" class="InductiveConstructor">Ctx</a> <a id="5416" class="Number">1</a> <a id="5418" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5420" class="Keyword">record</a> <a id="5427" class="Symbol">{</a> <a id="5429" href="Bitcoin.Tx.Base.html#658" class="Field">value</a> <a id="5435" class="Symbol">=</a> <a id="5437" href="SecureCompilation.Example.html#2804" class="Function">v</a> <a id="5439" class="Symbol">;</a> <a id="5441" href="Bitcoin.Tx.Base.html#680" class="Field">validator</a> <a id="5451" class="Symbol">=</a> <a id="5453" href="Bitcoin.Script.Base.html#2150" class="InductiveConstructor Operator">ƛ</a> <a id="5455" href="Bitcoin.Script.Base.html#1389" class="InductiveConstructor">versig</a> <a id="5462" href="Data.List.Base.html#4458" class="Function Operator">[</a> <a id="5464" href="SecureCompilation.Example.html#3448" class="Function">K</a> <a id="5466" href="Function.Base.html#1538" class="Function Operator">$</a> <a id="5468" href="Data.List.Relation.Unary.Any.html#1227" class="InductiveConstructor">there</a> <a id="5474" class="Symbol">(</a><a id="5475" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="5480" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="5484" class="Symbol">)</a> <a id="5486" href="Data.List.Base.html#4458" class="Function Operator">]</a> <a id="5488" href="Data.List.Base.html#4458" class="Function Operator">[</a> <a id="5490" href="Data.Fin.html#730" class="Function Operator">#</a> <a id="5492" class="Number">0</a> <a id="5494" href="Data.List.Base.html#4458" class="Function Operator">]</a> <a id="5496" class="Symbol">}</a><a id="5497" href="Data.Vec.Base.html#5711" class="Function Operator">]</a>
    <a id="5503" class="Symbol">;</a> <a id="5505" href="Bitcoin.Tx.Base.html#1132" class="Field">absLock</a> <a id="5513" class="Symbol">=</a> <a id="5515" href="SecureCompilation.Example.html#2795" class="Function">t</a> <a id="5517" class="Symbol">}</a>

  <a id="TimedCommitment.out"></a><a id="5522" href="SecureCompilation.Example.html#5522" class="Function">out</a> <a id="5526" class="Symbol">:</a> <a id="5528" href="Bitcoin.Tx.Base.html#1255" class="Function">∃Tx</a> <a id="5532" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="5534" class="Symbol">(</a><a id="5535" href="BitML.Contracts.Helpers.html#9974" class="Function">subterms⁺</a> <a id="5545" class="Symbol">(</a><a id="5546" href="BitML.Contracts.Induction.html#414" class="InductiveConstructor">CS</a> <a id="5549" href="Function.Base.html#1538" class="Function Operator">$</a> <a id="5551" href="SecureCompilation.Example.html#2824" class="Function">tc</a> <a id="5554" class="Symbol">.</a><a id="5555" href="BitML.Contracts.Types.html#2386" class="Field">C</a><a id="5556" class="Symbol">)</a> <a id="5558" href="Prelude.Lists.html#10340" class="Function Operator">↦</a> <a id="5560" href="Bitcoin.Tx.Base.html#1255" class="Function">∃Tx</a><a id="5563" class="Symbol">)</a>
  <a id="5567" href="SecureCompilation.Example.html#5522" class="Function">out</a> <a id="5571" class="Symbol">=</a> <a id="5573" href="SecureCompilation.Compiler.html#2440" class="Function">bitml-compiler</a> <a id="5588" class="Symbol">{</a><a id="5589" class="Argument">g</a> <a id="5591" class="Symbol">=</a> <a id="5593" href="SecureCompilation.Example.html#2824" class="Function">tc</a> <a id="5596" class="Symbol">.</a><a id="5597" href="BitML.Contracts.Types.html#2365" class="Field">G</a><a id="5598" class="Symbol">}</a> <a id="5600" class="Symbol">{</a><a id="5601" class="Argument">ds</a> <a id="5604" class="Symbol">=</a> <a id="5606" href="SecureCompilation.Example.html#2824" class="Function">tc</a> <a id="5609" class="Symbol">.</a><a id="5610" href="BitML.Contracts.Types.html#2386" class="Field">C</a><a id="5611" class="Symbol">}</a> <a id="5613" href="SecureCompilation.Example.html#3079" class="Function">valid</a> <a id="5619" href="SecureCompilation.Example.html#3153" class="Function">sechash</a> <a id="5627" href="SecureCompilation.Example.html#3241" class="Function">txout</a> <a id="5633" href="SecureCompilation.Example.html#3448" class="Function">K</a> <a id="5635" href="SecureCompilation.Example.html#3561" class="Function">K²</a>

  <a id="TimedCommitment.outTxs"></a><a id="5641" href="SecureCompilation.Example.html#5641" class="Function">outTxs</a> <a id="5648" class="Symbol">:</a> <a id="5650" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="5655" href="Bitcoin.Tx.Base.html#1255" class="Function">∃Tx</a>
  <a id="5661" href="SecureCompilation.Example.html#5641" class="Function">outTxs</a> <a id="5668" class="Symbol">=</a> <a id="5670" class="Keyword">let</a> <a id="5674" href="SecureCompilation.Example.html#5674" class="Bound">t₀</a> <a id="5677" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5679" href="SecureCompilation.Example.html#5679" class="Bound">m</a> <a id="5681" class="Symbol">=</a> <a id="5683" href="SecureCompilation.Example.html#5522" class="Function">out</a> <a id="5687" class="Keyword">in</a> <a id="5690" href="SecureCompilation.Example.html#5674" class="Bound">t₀</a> <a id="5693" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5695" href="SecureCompilation.Example.html#5679" class="Bound">m</a> <a id="5697" class="Symbol">(</a><a id="5698" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="5703" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="5707" class="Symbol">)</a> <a id="5709" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5711" href="SecureCompilation.Example.html#5679" class="Bound">m</a> <a id="5713" class="Symbol">(</a><a id="5714" href="Data.List.Relation.Unary.Any.html#1227" class="InductiveConstructor">there</a> <a id="5720" class="Symbol">(</a><a id="5721" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="5726" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="5730" class="Symbol">))</a> <a id="5733" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5735" href="SecureCompilation.Example.html#5679" class="Bound">m</a> <a id="5737" class="Symbol">(</a><a id="5738" href="Data.List.Relation.Unary.Any.html#1227" class="InductiveConstructor">there</a> <a id="5744" class="Symbol">(</a><a id="5745" href="Data.List.Relation.Unary.Any.html#1227" class="InductiveConstructor">there</a> <a id="5751" class="Symbol">(</a><a id="5752" href="Data.List.Relation.Unary.Any.html#1174" class="InductiveConstructor">here</a> <a id="5757" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="5761" class="Symbol">)))</a> <a id="5765" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5767" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>

  <a id="5773" href="SecureCompilation.Example.html#5773" class="Function">_</a> <a id="5775" class="Symbol">:</a> <a id="5777" href="SecureCompilation.Example.html#5641" class="Function">outTxs</a> <a id="5784" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="5786" class="Symbol">(</a><a id="5787" href="Data.Product.html#2196" class="Function Operator">-,</a> <a id="5790" href="Data.Product.html#2196" class="Function Operator">-,</a> <a id="5793" href="SecureCompilation.Example.html#4491" class="Function">Tᵢₙᵢₜ</a><a id="5798" class="Symbol">)</a> <a id="5800" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5802" class="Symbol">(</a><a id="5803" href="Data.Product.html#2196" class="Function Operator">-,</a> <a id="5806" href="Data.Product.html#2196" class="Function Operator">-,</a> <a id="5809" href="SecureCompilation.Example.html#4732" class="Function">T′</a><a id="5811" class="Symbol">)</a> <a id="5813" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5815" class="Symbol">(</a><a id="5816" href="Data.Product.html#2196" class="Function Operator">-,</a> <a id="5819" href="Data.Product.html#2196" class="Function Operator">-,</a> <a id="5822" href="SecureCompilation.Example.html#4957" class="Function">T′ᵃ</a><a id="5825" class="Symbol">)</a> <a id="5827" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5829" class="Symbol">(</a><a id="5830" href="Data.Product.html#2196" class="Function Operator">-,</a> <a id="5833" href="Data.Product.html#2196" class="Function Operator">-,</a> <a id="5836" href="SecureCompilation.Example.html#5237" class="Function">T′ᵇ</a><a id="5839" class="Symbol">)</a> <a id="5841" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5843" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>
  <a id="5848" class="Symbol">_</a> <a id="5850" class="Symbol">=</a> <a id="5852" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a>
</pre></body></html>